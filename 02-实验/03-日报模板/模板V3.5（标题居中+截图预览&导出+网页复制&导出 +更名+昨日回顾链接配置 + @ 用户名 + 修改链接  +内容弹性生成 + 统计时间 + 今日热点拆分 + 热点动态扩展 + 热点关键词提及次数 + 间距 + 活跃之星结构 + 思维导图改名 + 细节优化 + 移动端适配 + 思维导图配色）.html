<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[在此处填写报告标题] - [日期]</title>
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5rLesXWW/sGuLhYFChxgYnz2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            /* 极简主义风格配色 */
            --bg-primary: #f5f4ee; /* 略暖的米白色 */
            --bg-secondary: #faf9f6; /* 更浅的卡片背景色 */
            --bg-tertiary: #f1f3f5; /* 第三背景色，用于标签等 */
            --text-primary: #212529; /* 主要文字颜色 */
            --text-secondary: #495057; /* 次要文字颜色 */
            --accent-primary: #ff8906; /* 主要强调色 - 橙色 */
            --accent-secondary: #f76707; /* 次要强调色 - 深橙色 */
            --accent-tertiary: #e8590c; /* 第三强调色 - 焦橙色 */
            --accent-blue: #339af0;    /* 特定元素的蓝色强调 */
            --accent-purple: #7048e8; /* 词云的紫色强调 */
            --accent-cyan: #22b8cf;   /* 词云的青色强调 */
            --highlight-keyword-bg: #ffe8cc; /* 关键词高亮背景 */
            --highlight-name-color: #7048e8; /* 人名高亮颜色 */
            --card-padding: 24px; /* 卡片内边距 */
            --grid-gap: 16px; /* 网格间距 */
            --card-radius: 12px; /* 卡片圆角 */
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* 卡片阴影 */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            width: 100%;
            max-width: 1000px; /* 内容最大宽度 */
            margin: 0 auto; /* 内容居中 */
            padding: 20px; /* 内容周围内边距 */
        }

        h1, h2, h3, h4 {
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        h1 {
            font-size: 2.5rem; /* 主卡片大标题 */
            margin-bottom: 0.5rem;
            color: var(--accent-primary);
        }

        h2 { /* H2通用样式, 也用于主题卡片 */
            font-size: 1.75rem; /* 版块标题 */
            margin-bottom: 1rem;
            color: var(--accent-primary); /* 区块和主题卡片标题颜色 */
        }

        h3 { /* 用于子标题或特定元素，如统计卡片 */
            font-size: 1.25rem; /* 子版块标题 */
            margin-bottom: 0.75rem;
            color: var(--accent-blue); /* 子标题使用蓝色以形成对比 */
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr); /* 12列网格系统 */
            grid-auto-rows: minmax(100px, auto); /* 行高根据内容自动调整, 至少100px */
            gap: var(--grid-gap);
            margin-top: 20px;
            grid-template-areas: /* 更新的网格区域 */
                "main      main      main      main      main      main      main      main      main      main      main      main"
                "topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics"
                "mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap"
                "quote     quote     quote     quote     quote     quote     links     links     links     links     links     links"
                "stats     stats     stats     stats     stats     stats     stats     wordcloud wordcloud wordcloud wordcloud wordcloud"; /* 7:5 分割 */
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            box-shadow: var(--card-shadow);
            position: relative; /* 用于图标定位和伪元素 */
            overflow: hidden; /* 确保伪元素不超出卡片圆角 */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex; /* 为卡片内flex布局添加 */
            flex-direction: column; /* 垂直堆叠项目 */
        }

        .card:hover {
            transform: translateY(-5px); /* 鼠标悬停时轻微上浮效果 */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1); /* 鼠标悬停时增强阴影 */
        }

        /* 卡片顶部强调边框 */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-primary);
        }

        /* 卡片右下角装饰性图标 */
        .card-icon {
            position: absolute;
            bottom: var(--card-padding);
            right: var(--card-padding);
            font-size: 4rem;
            opacity: 0.07;
            color: var(--accent-primary);
        }

        /* 网格区域分配 */
        .main-card { grid-area: main; }
        .topic-cards-wrapper {
            grid-area: topics;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: var(--grid-gap);
        }
        .mindmap-card {
            grid-area: mindmap;
            min-height: 400px; /* 为思维导图卡片提供足够高度 */
        }
        .quote-card { grid-area: quote; }
        .links-card { grid-area: links; }
        .stats-card { grid-area: stats; } /* 由于grid-template-areas设置，将占据7列 */
        .wordcloud-card { grid-area: wordcloud; } /* 由于grid-template-areas设置，将占据5列 */

        /* topic-cards-wrapper 内单个主题卡片的样式 */
        .topic-card {
            grid-column: span 6; /* 默认占据6列 */
            min-height: 250px;
        }
        .topic-card > .topic-card-content-wrapper {
            flex-grow: 1; /* 使内容区域填满卡片剩余空间 */
            padding-bottom: 1rem; /* 内容区域底部的通用内边距 */
        }

        /* 如果主题卡片是奇数个，最后一个卡片占据整行 */
        .topic-cards-wrapper > .topic-card:nth-last-child(1):nth-child(odd) {
            grid-column: span 12;
        }

        .main-card h1 {
            text-align: center;
        }
        .main-card .date {
            text-align: center;
        }

        .date {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .meta-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .meta-info span {
            background-color: var(--bg-tertiary);
            padding: 5px 10px;
            border-radius: 20px; /* 胶囊形状 */
            font-size: 0.9rem;
            color: var(--accent-blue);
        }

        .summary {
            margin-top: 1rem;
            line-height: 1.7; /* 增加行高以提高可读性 */
            text-align: left; /* 摘要文本左对齐 */
        }

        .topic-category {
            display: inline-block; /* 使背景适应文本内容 */
            background-color: var(--accent-tertiary);
            color: var(--bg-primary); /* 确保文本在深色背景上可读 */
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .topic-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0.75rem;
            margin-bottom: 0.75rem; /* 关键词和提及次数之间的间距 */
        }

        .keyword {
            background-color: var(--bg-tertiary);
            color: var(--accent-primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .highlight-keyword {
            background-color: var(--highlight-keyword-bg);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }
        .highlight-name {
            color: var(--highlight-name-color);
            font-weight: 500;
        }

        .topic-mentions {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }


        .quote {
            position: relative;
            padding-left: 20px; /* 为引号图标留出空间 */
            margin: 10px 0;
            font-style: italic;
            color: var(--text-secondary);
        }

        .quote::before {
            content: '"'; /* 左引号 */
            position: absolute;
            left: 0;
            top: 0;
            font-size: 1.5rem; /* 引号大小 */
            color: var(--accent-tertiary);
        }

        .quote-author {
            text-align: right;
            font-size: 0.9rem;
            color: var(--accent-tertiary);
            margin-top: 5px;
        }

        .link-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 6px;
            background-color: var(--bg-tertiary);
            transition: background-color 0.2s ease;
            text-decoration: none; /* 移除外部div的下划线 */
        }

        .link-item:hover {
            background-color: rgba(51, 154, 240, 0.1); /* 鼠标悬停时淡蓝色背景 */
        }
        
        .link-item a { /* 使整个链接项可点击 */
            text-decoration: none;
            color: inherit; /* 继承父元素颜色 */
            display: flex; /* 内部元素对齐 */
            align-items: center;
            width: 100%;
        }

        .link-item a:hover .link-title { /* 仅在悬停时给标题添加下划线 */
            text-decoration: underline;
            color: var(--accent-blue);
        }


        .link-icon {
            margin-right: 10px;
            color: var(--accent-blue);
        }

        .link-title {
            flex-grow: 1; /* 占据剩余空间 */
            color: var(--text-primary); /* 默认链接标题颜色 */
        }
        
        .link-title.is-link { /* 如果是实际链接，则使用强调色 */
            color: var(--accent-blue);
        }
        .link-title.is-link:hover {
            text-decoration: underline;
        }

        .user-stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem; /* 表格与标题间距 */
        }
        .user-stats-table th {
            text-align: left;
            padding: 0.75rem 0.5rem; /* 单元格内边距 */
            border-bottom: 2px solid var(--accent-primary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem; /* 表头字体大小 */
        }
        .user-stats-table td {
            padding: 0.75rem 0.5rem; /* 单元格内边距 */
            border-bottom: 1px solid var(--bg-tertiary);
            color: var(--text-secondary);
            font-size: 0.85rem; /* 表格内容字体大小 */
            vertical-align: top; /* 内容较多时顶部对齐 */
        }
        .user-stats-table tr:last-child td {
            border-bottom: none;
        }
        .user-stats-table .user-name-col { /* 用户名列宽度 */
            width: 25%;
            font-weight: 500; /* 用户名稍作强调 */
        }
        .user-stats-table .message-count-col { /* 发言数列宽度和对齐 */
            width: 15%;
            text-align: center;
            white-space: nowrap; /* 保持发言数在同一行 */
        }
        .user-stats-table .contribution-col { /* 主要贡献列宽度 */
            width: 60%;
        }

        /* 思维导图卡片特定样式 */
        .mindmap-controls { /* 内联思维导图的控制按钮 */
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .mindmap-controls button {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--card-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .mindmap-controls button:hover {
            background-color: #228be6; /* 深蓝色 */
        }
        .mindmap-controls button i {
            margin-right: 5px;
        }
        #openMindmapModalBtn { /* 打开模态框的按钮 */
            margin-left: auto; /* 将此按钮推到右侧 */
        }

        .mermaid-container { /* 内联Mermaid容器 */
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto; /* 内容超出时可滚动 */
            background-color: #fff; /* 思维导图背景设为白色以保证对比度 */
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--bg-tertiary);
            min-height: 200px; /* 确保有最小高度 */
        }
        .mermaid-container svg, #modalMermaidContainer svg { /* 应用于两个容器内的SVG */
            max-width: 100%; /* 确保SVG响应式 */
            height: auto;   /* 保持宽高比 */
            transition: transform 0.2s ease-out; /* 缩放动画 */
            /* 拖动功能会直接修改 transform, 所以这里的 transition 主要用于缩放 */
        }
        
        /* 模态框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-content {
            background-color: var(--bg-secondary);
            padding: var(--card-padding);
            border-radius: var(--card-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 800px;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 防止内容溢出 */
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--bg-tertiary);
            padding-bottom: 10px;
        }
        .modal-header h3 {
            margin-bottom: 0;
            color: var(--accent-primary);
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0 10px;
        }
        .modal-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 确保内部容器可控 */
        }
        .modal-mindmap-controls { /* 模态框内思维导图控制按钮 */
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bg-tertiary);
        }
        .modal-mindmap-controls button { /* 样式与内联控制按钮一致 */
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--card-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .modal-mindmap-controls button:hover {
            background-color: #228be6; /* 深蓝色 */
        }
        .modal-mindmap-controls button i {
            margin-right: 5px;
        }
        #modalMermaidContainer {
            flex-grow: 1;
            overflow: auto; /* 允许在模态框内滚动/平移思维导图 */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff; /* 模态框内思维导图背景 */
            border-radius: 8px;
        }

        .wordcloud {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* 词云居中对齐 */
            gap: 10px;
            padding: 20px 0;
        }

        .wordcloud-item {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .wordcloud-item:hover {
            transform: scale(1.1); /* 鼠标悬停放大效果 */
        }

        /* 词云字体大小和颜色 */
        .size-1 { font-size: 0.9rem; color: var(--text-secondary); }
        .size-2 { font-size: 1.1rem; color: var(--accent-cyan); }
        .size-3 { font-size: 1.3rem; color: var(--accent-blue); }
        .size-4 { font-size: 1.5rem; color: var(--accent-purple); }
        .size-5 { font-size: 1.8rem; color: var(--accent-tertiary); }
        
        .action-buttons-container {
            text-align: center;
            margin: 20px 0;
            padding-bottom: 20px; /* 底部留白 */
        }

        .action-button {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--card-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px 10px; /* 按钮间距 */
            box-shadow: var(--card-shadow);
            display: inline-flex; /* 用于图标和文本对齐 */
            align-items: center; /* 垂直居中图标和文本 */
            justify-content: center; /* 水平居中内容 */
        }

        .action-button:hover {
            background-color: var(--accent-secondary);
            transform: translateY(-2px);
        }
         .action-button i { /* FontAwesome 图标的间距 */
            margin-right: 8px;
        }
        .action-button .fas { /* 兼容旧版 FontAwesome 用法 */
            margin-right: 8px;
        }


        .footer {
            margin-top: 30px; /* 页脚与上方内容的间距 */
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        #report-content-wrapper .footer { /* 确保截图时包含页脚 */
            margin-top: 30px; /* 调整与上方内容的间距 */
            padding-bottom: 20px; /* 增加底部内边距，确保截图完整 */
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card { animation: fadeIn 0.5s ease forwards; } /* 所有卡片应用淡入动画 */

        /* 为不同卡片设置动画延迟，实现依次出现的效果 */
        .main-card { animation-delay: 0.1s; }
        .topic-cards-wrapper .topic-card:nth-child(1) { animation-delay: 0.2s; }
        .topic-cards-wrapper .topic-card:nth-child(2) { animation-delay: 0.3s; }
        .topic-cards-wrapper .topic-card:nth-child(3) { animation-delay: 0.4s; }
        .topic-cards-wrapper .topic-card:nth-child(4) { animation-delay: 0.5s; } 
        
        .mindmap-card { animation-delay: 0.6s; } 

        .quote-card { animation-delay: 0.7s; } 
        .links-card { animation-delay: 0.8s; }
        .stats-card { animation-delay: 0.9s; }
        .wordcloud-card { animation-delay: 1.0s; }
        #report-content-wrapper .footer { animation-delay: 1.1s; } 
        .action-buttons-container { animation-delay: 1.2s; }


        /* 移动端响应式样式 */
        @media (max-width: 768px) { 
            body {
                padding: 10px;
                font-size: 14px; /* 移动端基础字体大小 */
            }

            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; } 
            h3 { font-size: 1.1rem; }

            .grid-container {
                grid-template-columns: 1fr; /* 单列布局 */
                grid-template-areas: /* 垂直堆叠所有区域 */
                    "main"
                    "topics"
                    "mindmap"
                    "quote"
                    "links"
                    "stats"
                    "wordcloud";
            }
            
            .topic-cards-wrapper {
                grid-template-columns: 1fr; /* 主题卡片也单列，确保铺满 */
            }
            .topic-card { 
                grid-column: 1 / -1; /* 主题卡片占据整行 */
                min-height: auto; /* 高度自动 */
            }
            .topic-card > .topic-card-content-wrapper {
                padding-bottom: 1rem; /* 确保内容底部有空间 */
            }
            .topic-mentions { /* 提及次数在移动端调整 */
                position: static; /* 恢复正常流布局 */
                margin-top: 10px; /* 与上方内容间距 */
                margin-bottom: 10px; /* 与下方内容间距 */
                text-align: left; /* 左对齐 */
            }
            .card-icon { /* 卡片图标在移动端调整 */
                position: relative; /* 恢复正常流布局 */
                bottom: auto;
                right: auto;
                margin-top: auto; /* 推到底部 */
                margin-left: auto; /* 推到右侧 */
                padding-top: 10px; /* 与内容间距 */
            }
            .user-stats-table th, .user-stats-table td {
                padding: 0.5rem 0.25rem; /* 减小单元格内边距 */
                font-size: 0.8rem; /* 减小字体 */
            }
            .user-stats-table .user-name-col,
            .user-stats-table .message-count-col,
            .user-stats-table .contribution-col {
                width: auto; /* 列宽自动 */
            }
            .user-stats-table .message-count-col {
                text-align: left; /* 发言数左对齐 */
                white-space: normal; /* 允许发言数换行 */
            }
            .mindmap-controls {
                flex-wrap: wrap; /* 控制按钮换行 */
            }
            .mindmap-controls button {
                font-size: 0.8rem;
                padding: 6px 10px;
            }
            .modal-content { /* 模态框在移动端调整大小 */
                width: 95vw;
                height: 85vh;
            }


            .action-button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            .action-buttons-container { /* 操作按钮容器在移动端使用flex布局 */
                display: flex;
                flex-wrap: wrap; 
                justify-content: center; 
                gap: 10px; 
            }
            .action-buttons-container .action-button { /* 按钮宽度调整 */
                width: calc(50% - 10px); /* 每行两个按钮，减去gap */
                min-width: 180px; /* 按钮最小宽度 */
                margin: 5px 0; /* 移除左右margin，由gap控制 */
            }
            /* 屏幕更小时的响应式调整 */
            @media (max-width: 480px) {
                .action-buttons-container .action-button {
                    width: 80%; /* 按钮宽度进一步增大 */
                }
                .user-stats-table { /* 表格转换为卡片式列表 */
                    display: block; 
                    overflow-x: auto; /* 如果内容实在太宽，允许水平滚动，但理想是内容自适应 */
                }
                .user-stats-table th, .user-stats-table td {
                    white-space: normal; /* 允许内容换行 */
                }
                .user-stats-table thead, .user-stats-table tbody, .user-stats-table tr {
                    display: block; /* 使表头、表体、行表现为块级元素 */
                }
                .user-stats-table tr {
                    border-bottom: 1px solid var(--bg-tertiary); /* 每“行”下方加边框 */
                }
                /* .user-stats-table td:last-child {  移除这个，因为tr的边框更合适 
                    border-bottom: none;
                } */
                .user-stats-table th {
                    display: none; /* 隐藏原始表头 */
                }
                .user-stats-table td {
                    display: block; /* 单元格表现为块级 */
                    text-align: left !important; /* 强制左对齐 */
                    border-bottom: none; /* 单元格自身无下边框 */
                    padding-left: 0.5rem; /* 左侧内边距 */
                }
                .user-stats-table td::before { /* 使用伪元素显示表头信息 */
                    content: attr(data-label); /* 获取data-label属性值 */
                    font-weight: bold;
                    display: inline-block;
                    width: 100px; /* 标签宽度 */
                    margin-right: 10px;
                    color: var(--text-primary);
                }
                .user-stats-table tr:last-child { /* 最后一个“行”移除下边框 */
                    border-bottom: none;
                }
                .mindmap-controls {
                    justify-content: center; /* 思维导图控制按钮居中 */
                }
                .mindmap-controls button { /* 包括 #openMindmapModalBtn */
                    width: calc(50% - 5px); /* 每行两个按钮 */
                    margin-bottom: 5px;
                }
                /*
                // 如果需要在极小屏幕上让全屏查看按钮单独一行且占满宽度，可以取消注释以下代码
                #openMindmapModalBtn {
                    width: 100%; 
                }
                */
                .modal-mindmap-controls button {
                    width: calc(33.33% - 7px); /* 模态框内三个按钮一行 */
                    margin-bottom: 5px;
                }
            }
        }
        #feedback-message { /* 操作反馈信息样式 */
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
        }
        #feedback-message.success {
            color: green;
        }
        #feedback-message.error {
            color: red;
        }
    </style>
</head>
<body>
    <div id="report-content-wrapper"> <div class="grid-container">
            <div class="card main-card">
                <h1>[主报告标题 - 例如：AI产品团日报]</h1>
                <div class="date">[日期 - 例如：2025年5月19日]</div>
                <div class="meta-info">
                    <span><i class="fas fa-comment"></i> 消息数: [数字]+</span>
                    <span><i class="fas fa-users"></i> 活跃用户: [数字]+</span>
                    <span><i class="fas fa-fire"></i> 热点话题: [数字]</span>
                    <span><i class="fas fa-clock"></i> 统计时间: [时间范围]</span>
                </div>
                <p class="summary">[在此处填写当日讨论的总体摘要。保持简洁明了，突出群组的主要主题和氛围。]</p>
                <i class="fas fa-microchip card-icon"></i> </div>

            <div class="topic-cards-wrapper">
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-lightbulb"></i> [主题1标题]</h2>
                        <div class="topic-category">[分类1 - 例如：工具技巧]</div>
                        <p>关于<span class="highlight-keyword">插件功能</span>的讨论，特别是<span class="highlight-name">@用户A</span>提到的<span class="highlight-keyword">上下文处理</span>能力。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词1A]</span>
                            <span class="keyword">[关键词1B]</span>
                            <span class="keyword">[关键词1C]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量1]</div>
                    </div>
                    <i class="fas fa-tools card-icon"></i> 
                </div>

                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-rocket"></i> [主题2标题]</h2>
                        <div class="topic-category">[分类2 - 例如：新功能]</div>
                        <p><span class="highlight-name">@用户B</span>分享了<span class="highlight-keyword">AI搜索</span>的最新进展和<span class="highlight-keyword">地区限制</span>问题。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词2A]</span>
                            <span class="keyword">[关键词2B]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量2]</div>
                    </div>
                    <i class="fas fa-star card-icon"></i> 
                </div>
                
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-comments-dollar"></i> [主题3标题]</h2>
                        <div class="topic-category">[分类3 - 例如：工具体验]</div>
                        <p>大家对<span class="highlight-keyword">Agent技术</span>的<span class="highlight-keyword">商业化前景</span>进行了探讨，<span class="highlight-name">@用户C</span>提出了独到见解。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词3A]</span>
                            <span class="keyword">[关键词3B]</span>
                            <span class="keyword">[关键词3C]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量3]</div>
                    </div>
                    <i class="fas fa-comments card-icon"></i> 
                </div>
                </div>

            <div class="card mindmap-card">
                <h2><i class="fas fa-sitemap"></i> 核心概念关系图</h2>
                <div class="mindmap-controls">
                    <button id="zoomInBtn"><i class="fas fa-search-plus"></i> 放大</button>
                    <button id="zoomOutBtn"><i class="fas fa-search-minus"></i> 缩小</button>
                    <button id="downloadSvgBtn"><i class="fas fa-download"></i> 下载</button>
                    <button id="openMindmapModalBtn"><i class="fas fa-expand"></i> 全屏查看</button>
                </div>
                <div class="mermaid-container" id="inlineMermaidContainer"> <div class="mermaid" id="mindmapDiagram">
                    mindmap
                      root((群聊核心主题))
                        ([主题1: NotebookLM技巧])
                          ([PageTalk插件讨论])
                          ([万能Prompt分享])
                        ([主题2: AI行业观察])
                          ([Google AI搜索])
                          ([Agent与工作流商业化])
                        ([主题3: 工具测评])
                          ([Google Imagen效果])
                          ([其他工具提及])
                    </div>
                </div>
                <i class="fas fa-project-diagram card-icon"></i>
            </div>

            <div class="card quote-card">
                <h2><i class="fas fa-quote-left"></i> 精彩引用</h2>
                <div class="quote">
                    "[引言1内容。使其具有影响力或代表性。]"
                    <div class="quote-author">- @[发言人1]</div>
                </div>
                <div class="quote">
                    "[引言2内容。]"
                    <div class="quote-author">- @[发言人2]</div>
                </div>
                <div class="quote">
                    "[引言3内容。]"
                    <div class="quote-author">- @[发言人3]</div>
                </div>
                <i class="fas fa-comment-dots card-icon"></i> 
            </div>

            <div class="card links-card">
                <h2><i class="fas fa-link"></i> 重要链接与资源</h2>
                <div class="link-item">
                    <a href="[URL链接1]" target="_blank">
                        <i class="fas fa-external-link-alt link-icon"></i> 
                        <span class="link-title">[链接1标题]</span>
                    </a>
                </div>
                <div class="link-item">
                    <a href="[URL链接2]" target="_blank">
                        <i class="fas fa-external-link-alt link-icon"></i>
                        <span class="link-title">[链接2标题]</span>
                    </a>
                </div>
                <div class="link-item"> <i class="fas fa-file link-icon"></i> 
                    <span class="link-title">[文档1标题 - 例如：共享提示词V5]</span> 
                </div>
                <i class="fas fa-share-alt card-icon"></i> 
            </div>

            <div class="card stats-card">
                <h2><i class="fas fa-chart-line"></i> 活跃之星</h2>
                <table class="user-stats-table">
                    <thead>
                        <tr>
                            <th class="user-name-col">用户</th>
                            <th class="message-count-col">发言数</th>
                            <th class="contribution-col">主要贡献</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="用户">@发言人1</td>
                            <td data-label="发言数" class="message-count-col">[数量1]+</td>
                            <td data-label="主要贡献">[用户1的主要贡献内容 - 例如：分享 PageTalk 插件和万能 Prompt 生成器]</td>
                        </tr>
                        <tr>
                            <td data-label="用户">@发言人2</td>
                            <td data-label="发言数" class="message-count-col">[数量2]+</td>
                            <td data-label="主要贡献">[用户2的主要贡献内容 - 例如：PageTalk 插件开发者，分享使用体验]</td>
                        </tr>
                        <tr>
                            <td data-label="用户">@发言人3</td>
                            <td data-label="发言数" class="message-count-col">[数量3]+</td>
                            <td data-label="主要贡献">[用户3的主要贡献内容 - 例如：参与 Agent 讨论和工具测试]</td>
                        </tr>
                    </tbody>
                </table>
                <i class="fas fa-user-friends card-icon"></i> 
            </div>

            <div class="card wordcloud-card">
                <h2><i class="fas fa-cloud"></i> 词云</h2>
                <div class="wordcloud">
                    <span class="wordcloud-item size-5">[关键词A]</span>
                    <span class="wordcloud-item size-5">[关键词B]</span>
                    <span class="wordcloud-item size-4">[关键词C]</span>
                    <span class="wordcloud-item size-4">[关键词D]</span>
                    <span class="wordcloud-item size-3">[关键词E]</span>
                    <span class="wordcloud-item size-3">[关键词F]</span>
                    <span class="wordcloud-item size-2">[关键词G]</span>
                    <span class="wordcloud-item size-2">[关键词H]</span>
                    <span class="wordcloud-item size-1">[关键词I]</span>
                </div>
                <i class="fas fa-tags card-icon"></i> 
            </div>
        </div> 
        
        <div class="footer">
            <p>数据来源：[您的数据来源 - 例如：AI产品团聊天记录] | 生成时间：[生成日期] | 统计周期：[统计周期 - 例如：[日期]全天]</p>
            <p>[免责声明 - 例如：本报告由AI自动生成，仅供参考，不代表所有群成员观点。]</p>
        </div>
    </div> 

    <div id="mindmapModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>核心概念关系图</h3>
                <button id="modalCloseBtn" class="modal-close-btn" aria-label="关闭">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-mindmap-controls">
                    <button id="modalZoomInBtn"><i class="fas fa-search-plus"></i> 放大</button>
                    <button id="modalZoomOutBtn"><i class="fas fa-search-minus"></i> 缩小</button>
                    <button id="modalDownloadSvgBtn"><i class="fas fa-download"></i> 下载</button> 
                </div>
                <div id="modalMermaidContainer">
                    </div>
            </div>
        </div>
    </div>

    <div class="action-buttons-container">
        <button id="viewPreviousReportBtn" class="action-button"><i class="fas fa-calendar-alt"></i> 查看昨日日报</button>
        <button id="screenshotToClipboardBtn" class="action-button"><i class="fas fa-clipboard"></i> 拷贝截图</button>
        <button id="screenshotDownloadBtn" class="action-button"><i class="fas fa-camera"></i> 下载截图</button>
        <button id="copyHtmlBtn" class="action-button"><i class="fas fa-copy"></i> 拷贝源码</button>
        <button id="downloadHtmlBtn" class="action-button"><i class="fas fa-download"></i> 下载报告</button>
    </div>
    <div id="feedback-message"></div> <script>
        // 初始化 Mermaid.js
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base', 
            fontFamily: '"Inter", sans-serif',
            mindmap: { 
                padding: 15, 
            }
        });

        // 思维导图变换状态变量
        let currentScale = 1; 
        let translateX_inline = 0;
        let translateY_inline = 0;

        let modalCurrentScale = 1;
        let translateX_modal = 0;
        let translateY_modal = 0;
        
        // 更新SVG变换（平移和缩放）的辅助函数
        function updateSvgTransform(svgElement, scale, tx, ty) {
            if (svgElement) {
                svgElement.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
                svgElement.style.transformOrigin = 'center center'; 
            }
        }

        // 为SVG元素附加拖动监听器的函数
        function attachDragListeners(svgElement, getScaleCallback, setTranslateXYCallback, getTranslateXYCallback) {
            if (!svgElement) return;
            svgElement.style.cursor = 'grab';
            let isDragging = false;
            let startX, startY;
            let initialTx, initialTy;

            const onDragStart = (e) => {
                isDragging = true;
                const currentCoords = e.type.startsWith('touch') ? e.touches[0] : e;
                startX = currentCoords.clientX;
                startY = currentCoords.clientY;
                const currentPos = getTranslateXYCallback();
                initialTx = currentPos.tx;
                initialTy = currentPos.ty;
                svgElement.style.cursor = 'grabbing';
                if (e.type.startsWith('touch')) { // 防止触摸拖动时页面滚动
                    e.preventDefault();
                }
            };

            const onDragMove = (e) => {
                if (!isDragging) return;
                const currentCoords = e.type.startsWith('touch') ? e.touches[0] : e;
                const deltaX = currentCoords.clientX - startX;
                const deltaY = currentCoords.clientY - startY;
                updateSvgTransform(svgElement, getScaleCallback(), initialTx + deltaX, initialTy + deltaY);
                 if (e.type.startsWith('touch')) { 
                    e.preventDefault();
                }
            };

            const onDragEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;
                svgElement.style.cursor = 'grab';
                
                const currentCoords = e.type.startsWith('touch') ? e.changedTouches[0] : e;
                let finalDeltaX = 0;
                let finalDeltaY = 0;

                if (currentCoords && typeof currentCoords.clientX !== 'undefined') {
                     finalDeltaX = currentCoords.clientX - startX;
                     finalDeltaY = currentCoords.clientY - startY;
                }
                // 如果 currentCoords 无效 (例如某些 touchend 事件没有 changedTouches)，
                // finalDeltaX 和 finalDeltaY 将保持为0，这意味着位置将基于 initialTx/Ty。
                // 更健壮的做法是在 onDragMove 中存储最新的 deltaX/Y，但当前实现依赖于 onDragEnd 事件提供坐标。

                setTranslateXYCallback(initialTx + finalDeltaX, initialTy + finalDeltaY);
            };
            
            // 移除旧的监听器（如果存在），防止重复添加
            svgElement.removeEventListener('mousedown', onDragStart);
            document.removeEventListener('mousemove', onDragMove);
            document.removeEventListener('mouseup', onDragEnd);
            svgElement.removeEventListener('mouseleave', onDragEnd); // 使用 onDragEnd 处理 mouseleave
            svgElement.removeEventListener('touchstart', onDragStart);
            document.removeEventListener('touchmove', onDragMove);
            document.removeEventListener('touchend', onDragEnd);

            // 添加新的监听器
            svgElement.addEventListener('mousedown', onDragStart);
            document.addEventListener('mousemove', onDragMove); 
            document.addEventListener('mouseup', onDragEnd);   
            svgElement.addEventListener('mouseleave', (event) => { // 如果鼠标在拖动时离开SVG，也结束拖动
                if(isDragging) onDragEnd(event);
            });

            svgElement.addEventListener('touchstart', onDragStart, { passive: false }); 
            document.addEventListener('touchmove', onDragMove, { passive: false });
            document.addEventListener('touchend', onDragEnd);
        }

        // 使SVG可拖动的函数，包括处理Mermaid异步渲染
        function makeSvgDraggable(containerElement, getScaleCb, setTranslateCb, getTranslateCb) {
            if (!containerElement) return;

            let svgEl = containerElement.querySelector('svg');

            const setupDrag = (targetSvg) => {
                attachDragListeners(targetSvg, getScaleCb, setTranslateCb, getTranslateCb);
            };

            if (svgEl) { // 如果SVG已存在 (例如模态框中的克隆SVG)
                setupDrag(svgEl);
            } else { // 如果SVG尚未由Mermaid渲染 (例如内联SVG)
                const observer = new MutationObserver((mutationsList, observerInstance) => {
                    for (const mutation of mutationsList) {
                        if (mutation.type === 'childList') {
                            const newSvg = containerElement.querySelector('svg');
                            if (newSvg) {
                                setupDrag(newSvg);
                                observerInstance.disconnect(); // 找到SVG后停止观察
                                break;
                            }
                        }
                    }
                });
                observer.observe(containerElement, { childList: true, subtree: true });
            }
        }


        // 内联思维导图缩放功能
        document.getElementById('zoomInBtn').addEventListener('click', function() {
            currentScale += 0.1;
            updateSvgTransform(document.querySelector('#inlineMermaidContainer svg'), currentScale, translateX_inline, translateY_inline);
        });

        document.getElementById('zoomOutBtn').addEventListener('click', function() {
            if (currentScale > 0.2) { 
                currentScale -= 0.1;
                updateSvgTransform(document.querySelector('#inlineMermaidContainer svg'), currentScale, translateX_inline, translateY_inline);
            }
        });
        
        // 从指定SVG元素下载SVG文件的辅助函数 (保持不变)
        function downloadSVGFromElement(svgElement, baseFilename) {
            if (svgElement) {
                const originalTransform = svgElement.style.transform;
                // 为了下载，临时移除平移，只保留缩放为1，或者根据需求保留当前视图
                // 这里我们下载的是原始未平移、未缩放的SVG（Mermaid的原始输出）
                // 如果要下载当前视图，需要更复杂的处理来烘焙transform到SVG路径
                // 简单起见，我们下载的是“干净”的SVG，但用户可能期望下载所见即所得
                // 为了更接近所见即所得，我们仅重置缩放进行下载，平移效果会保留
                const tempScale = 1; // 下载时使用原始比例
                const currentTx = parseFloat(svgElement.style.transform.split('translate(')[1]?.split('px')[0] || 0);
                const currentTy = parseFloat(svgElement.style.transform.split(',')[1]?.split('px')[0] || 0);

                svgElement.style.transform = `translate(${currentTx}px, ${currentTy}px) scale(${tempScale})`; // 仅应用平移，缩放为1
                
                const svgData = new XMLSerializer().serializeToString(svgElement);
                svgElement.style.transform = originalTransform; // 恢复原始变换

                const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                let filename = baseFilename; 
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim().replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_') + '-' + baseFilename;
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim().replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_');
                }
                filename += '.svg'; 
                filename = filename.replace(/_+/g, '_');

                link.href = url;
                link.download = filename; 
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showFeedbackMessage(baseFilename + '已下载!', 'success'); 
            } else {
                showFeedbackMessage('无法下载：未找到' + baseFilename + '。', 'error'); 
            }
        }

        // 下载内联卡片中的原始SVG
        document.getElementById('downloadSvgBtn').addEventListener('click', function() {
            downloadSVGFromElement(document.querySelector('#inlineMermaidContainer svg'), '核心概念关系图');
        });

        // 思维导图模态框逻辑
        const mindmapModal = document.getElementById('mindmapModal');
        const openMindmapModalBtn = document.getElementById('openMindmapModalBtn');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalMermaidContainer = document.getElementById('modalMermaidContainer');
        const modalDownloadSvgBtn = document.getElementById('modalDownloadSvgBtn');

        openMindmapModalBtn.addEventListener('click', function() {
            const originalSvgElement = document.querySelector('#inlineMermaidContainer svg');
            if (originalSvgElement) {
                modalMermaidContainer.innerHTML = ''; 
                const clonedSvg = originalSvgElement.cloneNode(true);
                
                translateX_modal = 0;
                translateY_modal = 0;
                modalCurrentScale = 1; 

                clonedSvg.style.transform = ''; 
                updateSvgTransform(clonedSvg, modalCurrentScale, translateX_modal, translateY_modal);
                
                clonedSvg.setAttribute('width', '100%'); 
                clonedSvg.setAttribute('height', '100%');
                clonedSvg.style.maxWidth = 'none'; 
                clonedSvg.style.maxHeight = 'none';
                modalMermaidContainer.appendChild(clonedSvg);
                
                makeSvgDraggable(modalMermaidContainer, // 注意这里传递的是容器元素
                    () => modalCurrentScale, 
                    (tx, ty) => { translateX_modal = tx; translateY_modal = ty; },
                    () => ({ tx: translateX_modal, ty: translateY_modal })
                );

                mindmapModal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; 
            } else {
                showFeedbackMessage('无法打开：未找到思维导图内容。', 'error');
            }
        });

        modalCloseBtn.addEventListener('click', function() {
            mindmapModal.style.display = 'none';
            modalMermaidContainer.innerHTML = ''; 
            document.body.style.overflow = 'auto'; 
        });

        window.addEventListener('click', function(event) {
            if (event.target === mindmapModal) {
                mindmapModal.style.display = 'none';
                modalMermaidContainer.innerHTML = '';
                document.body.style.overflow = 'auto';
            }
        });
        
        // 模态框内思维导图缩放
        document.getElementById('modalZoomInBtn').addEventListener('click', function() {
            modalCurrentScale += 0.1;
            updateSvgTransform(document.querySelector('#modalMermaidContainer svg'), modalCurrentScale, translateX_modal, translateY_modal);
        });

        document.getElementById('modalZoomOutBtn').addEventListener('click', function() {
            if (modalCurrentScale > 0.2) {
                modalCurrentScale -= 0.1;
                updateSvgTransform(document.querySelector('#modalMermaidContainer svg'), modalCurrentScale, translateX_modal, translateY_modal);
            }
        });

        if (modalDownloadSvgBtn) { 
            modalDownloadSvgBtn.addEventListener('click', function() {
                downloadSVGFromElement(document.querySelector('#modalMermaidContainer svg'), '核心概念关系图-全屏');
            });
        }

        // 页面加载后初始化内联思维导图的拖动功能
        window.addEventListener('load', () => {
            const inlineMermaidContainerElement = document.getElementById('inlineMermaidContainer');
            if (inlineMermaidContainerElement) {
                 makeSvgDraggable(inlineMermaidContainerElement,
                    () => currentScale,
                    (tx, ty) => { translateX_inline = tx; translateY_inline = ty; },
                    () => ({ tx: translateX_inline, ty: translateY_inline })
                );
            }
        });

        // =====================================================================================
        // 在这里配置昨日日报的URL
        // =====================================================================================
        const previousReportUrl = "在此处填写昨日日报的URL"; 

        // 显示反馈信息的函数 (保持不变)
        function showFeedbackMessage(message, type = 'info', duration = 3000) {
            const feedbackElement = document.getElementById('feedback-message');
            if (feedbackElement) {
                feedbackElement.textContent = message;
                feedbackElement.className = type; 
                setTimeout(() => {
                    feedbackElement.textContent = '';
                    feedbackElement.className = '';
                }, duration);
            }
        }
        
        // 截图函数 (保持不变)
        async function captureScreenshot(elementToCapture) {
            await document.fonts.ready; 
            return html2canvas(elementToCapture, { 
                useCORS: true, 
                scale: window.devicePixelRatio || 1, 
                logging: false, 
                backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-primary').trim() || '#f5f4ee', 
                scrollX: -window.scrollX, 
                scrollY: -window.scrollY,
                windowWidth: document.documentElement.scrollWidth,
                windowHeight: document.documentElement.scrollHeight
            });
        }

        // “拷贝截图”按钮事件 (保持不变)
        document.getElementById('screenshotToClipboardBtn').addEventListener('click', async function() {
            const reportContent = document.getElementById('report-content-wrapper');
            if (!reportContent) {
                showFeedbackMessage('截图错误: 未找到报告内容。', 'error');
                return;
            }
            const actionButtons = document.querySelector('.action-buttons-container');
            const feedbackMsgElement = document.getElementById('feedback-message');
            const originalButtonText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 处理中...';
            this.disabled = true;
            actionButtons.style.visibility = 'hidden'; 
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden'; 

            try {
                const canvas = await captureScreenshot(reportContent);
                canvas.toBlob(async function(blob) {
                    if (blob) {
                        try {
                            if (navigator.clipboard && navigator.clipboard.write) {
                                await navigator.clipboard.write([
                                    new ClipboardItem({ 'image/png': blob })
                                ]);
                                showFeedbackMessage('截图已拷贝到剪贴板!', 'success');
                            } else {
                                showFeedbackMessage('截图已生成，但您的浏览器不支持直接拷贝图片。请尝试下载截图。', 'error', 5000);
                            }
                        } catch (copyError) {
                            console.error('拷贝到剪贴板失败:', copyError);
                            showFeedbackMessage('拷贝截图到剪贴板失败: ' + copyError.message, 'error', 5000);
                        }
                    } else {
                        throw new Error('无法将Canvas转换为Blob。');
                    }
                }, 'image/png');
            } catch (error) {
                console.error('截图捕获失败:', error);
                showFeedbackMessage('截图捕获失败: ' + error.message, 'error');
            } finally {
                actionButtons.style.visibility = 'visible'; 
                if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible'; 
                this.innerHTML = originalButtonText;
                this.disabled = false;
            }
        });

        // “下载截图”按钮事件 (保持不变)
        document.getElementById('screenshotDownloadBtn').addEventListener('click', async function() {
            const reportContent = document.getElementById('report-content-wrapper');
            if (!reportContent) {
                showFeedbackMessage('截图错误: 未找到报告内容。', 'error');
                return;
            }
            const actionButtons = document.querySelector('.action-buttons-container');
            const feedbackMsgElement = document.getElementById('feedback-message');
            const originalButtonText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 生成中...';
            this.disabled = true;
            actionButtons.style.visibility = 'hidden';
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';

            try {
                const canvas = await captureScreenshot(reportContent);
                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                
                let filename = 'AI产品日报截图';
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim();
                } else {
                    const pageTitleTag = document.querySelector('title');
                    if (pageTitleTag && pageTitleTag.textContent.includes('-')) {
                        filename = pageTitleTag.textContent.split('-')[0].trim();
                    }
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim();
                }
                filename += '.png';
                filename = filename.replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_').replace(/_+/g, '_');

                link.href = image;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showFeedbackMessage('截图已下载!', 'success');
            } catch (error) {
                console.error('下载截图失败:', error);
                showFeedbackMessage('下载截图失败: ' + error.message, 'error');
            } finally {
                actionButtons.style.visibility = 'visible';
                if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';
                this.innerHTML = originalButtonText;
                this.disabled = false;
            }
        });

        // “下载报告” (HTML) 按钮事件 (保持不变)
        document.getElementById('downloadHtmlBtn').addEventListener('click', function() {
            try {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const link = document.createElement('a');
                
                let filename = 'AI产品日报';
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim();
                } else {
                    const pageTitleTag = document.querySelector('title');
                    if (pageTitleTag && pageTitleTag.textContent.includes('-')) {
                        filename = pageTitleTag.textContent.split('-')[0].trim();
                    }
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim();
                }
                filename += '.html';
                filename = filename.replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_').replace(/_+/g, '_');

                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href); 
                showFeedbackMessage('HTML报告已下载!', 'success');
            } catch (error) {
                console.error('下载HTML失败:', error);
                showFeedbackMessage('下载HTML失败: ' + error.message, 'error');
            }
        });

        // “拷贝源码” (HTML) 按钮事件 (保持不变)
        document.getElementById('copyHtmlBtn').addEventListener('click', function() {
            const htmlContent = document.documentElement.outerHTML;
            const Gthis = this; 
            const originalButtonHTML = Gthis.innerHTML; 
            const textarea = document.createElement('textarea');
            textarea.value = htmlContent;
            textarea.style.position = 'fixed'; 
            textarea.style.top = '-9999px'; 
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            try {
                textarea.select();
                textarea.setSelectionRange(0, textarea.value.length); 
                if (document.execCommand('copy')) {
                    Gthis.innerHTML = '<i class="fas fa-check"></i> 已拷贝!';
                    showFeedbackMessage('HTML已拷贝到剪贴板!', 'success', 2000);
                } else {
                    Gthis.innerHTML = '<i class="fas fa-times"></i> 拷贝失败';
                    showFeedbackMessage('拷贝失败。您的浏览器可能不支持此操作。', 'error', 2000);
                }
            } catch (err) {
                Gthis.innerHTML = '<i class="fas fa-times"></i> 拷贝出错';
                showFeedbackMessage('拷贝出错: ' + err.message, 'error', 2000);
                console.error('拷贝HTML源码出错:', err);
            } finally {
                setTimeout(function() { 
                    Gthis.innerHTML = originalButtonHTML; 
                }, 2000);
                document.body.removeChild(textarea);
            }
        });

        // “查看昨日日报”按钮事件 (保持不变)
        document.getElementById('viewPreviousReportBtn').addEventListener('click', function() {
            const urlToOpen = previousReportUrl.trim();
            const placeholderUrlText = "在此处填写昨日日报的URL"; 
            if (urlToOpen && urlToOpen !== placeholderUrlText && (urlToOpen.startsWith('http://') || urlToOpen.startsWith('https://') || !urlToOpen.includes('://'))) {
                let finalUrl = urlToOpen;
                const newWindow = window.open(finalUrl, '_blank'); 
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    showFeedbackMessage('无法打开新窗口。请检查您的弹出窗口拦截设置。', 'error', 5000);
                }
            } else {
                showFeedbackMessage('昨日日报的URL未配置或无效。请检查脚本中的 previousReportUrl 变量，并确保它是一个有效的网址或相对路径。', 'error', 5000);
            }
        });

        // 根据窗口大小调整操作按钮布局的函数 (保持不变)
        function adjustActionButtonsLayout() {
            const actionButtonsContainer = document.querySelector('.action-buttons-container');
            if (actionButtonsContainer) {
                if (window.innerWidth <= 768) { 
                    actionButtonsContainer.style.display = 'flex';
                    actionButtonsContainer.style.flexWrap = 'wrap';
                    actionButtonsContainer.style.justifyContent = 'center';
                } else { 
                    actionButtonsContainer.style.display = 'block'; 
                    actionButtonsContainer.style.flexWrap = 'nowrap'; 
                }
            }
        }
        window.addEventListener('load', adjustActionButtonsLayout);
        window.addEventListener('resize', adjustActionButtonsLayout);

    </script>
</body>
</html>