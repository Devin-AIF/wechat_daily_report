<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[在此处填写报告标题] - [日期]</title>
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5rLesXWW/sGuLhYFChxgYnz2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            /* 极简主义风格配色 */
            --bg-primary: #f5f4ee; /* Slightly warmer off-white */
            --bg-secondary: #faf9f6; /* Even lighter for cards */
            --bg-tertiary: #f1f3f5;
            --text-primary: #212529;
            --text-secondary: #495057;
            --accent-primary: #ff8906; /* 主要强调色 - 橙色 */
            --accent-secondary: #f76707; /* 次要强调色 - 深橙色 */
            --accent-tertiary: #e8590c; /* 第三强调色 - 焦橙色 */
            --accent-blue: #339af0;    /* 特定元素的蓝色强调 */
            --accent-purple: #7048e8; /* 词云的紫色强调 */
            --accent-cyan: #22b8cf;   /* 词云的青色强调 */
            --highlight-keyword-bg: #ffe8cc; /* Background for highlighted keywords */
            --highlight-name-color: #7048e8; /* Color for highlighted names */
            --card-padding: 24px;
            --grid-gap: 16px;
            --card-radius: 12px;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            width: 100%;
            max-width: 1000px; /* 内容最大宽度 */
            margin: 0 auto; /* 内容居中 */
            padding: 20px; /* 内容周围内边距 */
        }

        h1, h2, h3, h4 {
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        h1 {
            font-size: 2.5rem; /* 主卡片大标题 */
            margin-bottom: 0.5rem;
            color: var(--accent-primary);
        }

        h2 { /* General styling for H2, will be used in topic cards as well */
            font-size: 1.75rem; /* 版块标题 */
            margin-bottom: 1rem;
            color: var(--accent-primary); /* Titles for sections and topic cards */
        }

        h3 { /* Used for sub-headings if any, or specific elements like in stats card */
            font-size: 1.25rem; /* 子版块标题 */
            margin-bottom: 0.75rem;
            color: var(--accent-blue); /* 子标题使用蓝色以形成对比 */
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr); /* 12列网格系统 */
            grid-auto-rows: minmax(100px, auto); /* 行高根据内容自动调整, 至少100px */
            gap: var(--grid-gap);
            margin-top: 20px;
            grid-template-areas: /* Updated grid areas */
                "main      main      main      main      main      main      main      main      main      main      main      main"
                "tts       tts       tts       tts       tts       tts       tts       tts       tts       tts       tts       tts" /* TTS Player Area */
                "topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics"
                "mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap"
                "quote     quote     quote     quote     quote     quote     links     links     links     links     links     links"
                "stats     stats     stats     stats     stats     stats     stats     wordcloud wordcloud wordcloud wordcloud wordcloud"; /* 7:5 split */
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            box-shadow: var(--card-shadow);
            position: relative; /* 用于图标定位和伪元素 */
            overflow: hidden; /* 确保伪元素不超出卡片圆角 */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex; /* Added for flex layout within card */
            flex-direction: column; /* Stack items vertically */
        }

        .card:hover {
            transform: translateY(-5px); /* 鼠标悬停时轻微上浮效果 */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1); /* 鼠标悬停时增强阴影 */
        }

        /* 卡片顶部强调边框 */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-primary);
        }

        /* 卡片右下角装饰性图标 */
        .card-icon {
            position: absolute;
            bottom: var(--card-padding); 
            right: var(--card-padding); 
            font-size: 4rem; 
            opacity: 0.07; 
            color: var(--accent-primary);
        }

        /* Grid area assignments */
        .main-card { grid-area: main; }
        .tts-player-card { grid-area: tts; } /* TTS Player Card */
        .topic-cards-wrapper {
            grid-area: topics;
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: var(--grid-gap);
        }
        .mindmap-card { 
            grid-area: mindmap; 
            min-height: 400px; /* Give mindmap card enough height */
        }
        .quote-card { grid-area: quote; }
        .links-card { grid-area: links; }
        .stats-card { grid-area: stats; } /* Will take 7 columns due to grid-template-areas */
        .wordcloud-card { grid-area: wordcloud; } /* Will take 5 columns due to grid-template-areas */

        /* Styling for individual topic cards within the wrapper */
        .topic-card {
            grid-column: span 6; 
            min-height: 250px; 
        }
        .topic-card > .topic-card-content-wrapper { 
            flex-grow: 1; 
            padding-bottom: 1rem; /* General padding at the bottom of content area */
        }

        .topic-cards-wrapper > .topic-card:nth-last-child(1):nth-child(odd) {
            grid-column: span 12;
        }

        .main-card h1 {
            text-align: center;
        }
        .main-card .date {
            text-align: center;
        }

        .date {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .meta-info {
            display: flex;
            flex-wrap: wrap; 
            gap: 15px;
            margin-bottom: 1rem;
            justify-content: center; 
        }

        .meta-info span {
            background-color: var(--bg-tertiary);
            padding: 5px 10px;
            border-radius: 20px; 
            font-size: 0.9rem;
            color: var(--accent-blue);
        }

        .summary {
            margin-top: 1rem;
            line-height: 1.7; 
            text-align: left; 
        }

        .topic-category {
            display: inline-block; 
            background-color: var(--accent-tertiary);
            color: var(--bg-primary); 
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .topic-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0.75rem;
            margin-bottom: 0.75rem; /* Space between keywords and mentions */
        }

        .keyword {
            background-color: var(--bg-tertiary);
            color: var(--accent-primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .highlight-keyword {
            background-color: var(--highlight-keyword-bg);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }
        .highlight-name {
            color: var(--highlight-name-color);
            font-weight: 500;
        }

        .topic-mentions { 
            font-size: 0.9rem;
            color: var(--text-secondary);
        }


        .quote {
            position: relative;
            padding-left: 20px; 
            margin: 10px 0;
            font-style: italic;
            color: var(--text-secondary);
        }

        .quote::before {
            content: '"'; 
            position: absolute;
            left: 0;
            top: 0;
            font-size: 1.5rem; 
            color: var(--accent-tertiary);
        }

        .quote-author {
            text-align: right;
            font-size: 0.9rem;
            color: var(--accent-tertiary);
            margin-top: 5px;
        }

        .link-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 6px;
            background-color: var(--bg-tertiary);
            transition: background-color 0.2s ease;
            text-decoration: none; 
        }

        .link-item:hover {
            background-color: rgba(51, 154, 240, 0.1); 
        }
        
        .link-item a { 
            text-decoration: none;
            color: inherit; 
            display: flex; 
            align-items: center;
            width: 100%;
        }

        .link-item a:hover .link-title { 
             text-decoration: underline;
             color: var(--accent-blue);
        }


        .link-icon {
            margin-right: 10px;
            color: var(--accent-blue);
        }

        .link-title {
            flex-grow: 1; 
            color: var(--text-primary); 
        }
        
        .link-title.is-link { 
             color: var(--accent-blue);
        }
        .link-title.is-link:hover {
            text-decoration: underline;
        }

        .user-stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem; 
        }
        .user-stats-table th {
            text-align: left;
            padding: 0.75rem 0.5rem; 
            border-bottom: 2px solid var(--accent-primary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem; 
        }
        .user-stats-table td {
            padding: 0.75rem 0.5rem; 
            border-bottom: 1px solid var(--bg-tertiary);
            color: var(--text-secondary);
            font-size: 0.85rem; 
            vertical-align: top; 
        }
        .user-stats-table tr:last-child td {
            border-bottom: none;
        }
        .user-stats-table .user-name-col { 
            width: 25%;
            font-weight: 500; 
        }
        .user-stats-table .message-count-col { 
            width: 15%;
            text-align: center;
            white-space: nowrap; /* Keep message count on one line */
        }
        .user-stats-table .contribution-col { 
            width: 60%;
        }

        /* Mindmap Card Specific Styles */
        .mindmap-controls { /* Controls for inline mindmap */
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .mindmap-controls button {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--card-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .mindmap-controls button:hover {
            background-color: #228be6; /* Darker blue */
        }
        .mindmap-controls button i {
            margin-right: 5px;
        }
        #openMindmapModalBtn { /* Button to open the modal */
             margin-left: auto; /* Pushes this button to the right */
        }

        .mermaid-container { /* For inline mermaid */
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto; 
            background-color: #fff; 
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--bg-tertiary);
            min-height: 200px; 
        }
        .mermaid-container svg {
            max-width: 100%; 
            height: auto;   
            transition: transform 0.2s ease-out; 
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-content {
            background-color: var(--bg-secondary);
            padding: var(--card-padding);
            border-radius: var(--card-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 800px;
            display: flex;
            flex-direction: column;
            overflow: hidden; 
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--bg-tertiary);
            padding-bottom: 10px;
        }
        .modal-header h3 {
            margin-bottom: 0;
            color: var(--accent-primary);
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0 10px;
        }
        .modal-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; 
        }
        .modal-mindmap-controls { /* Controls for modal mindmap */
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bg-tertiary);
        }
        .modal-mindmap-controls button { /* Style to match inline controls */
             background-color: var(--accent-blue);
             color: white;
             border: none;
             padding: 8px 12px;
             border-radius: var(--card-radius);
             font-size: 0.9rem;
             cursor: pointer;
             transition: background-color 0.2s ease;
        }
        .modal-mindmap-controls button:hover {
             background-color: #228be6; /* Darker blue */
        }
        .modal-mindmap-controls button i {
            margin-right: 5px;
        }
        #modalMermaidContainer {
            flex-grow: 1;
            overflow: auto; 
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff; 
             border-radius: 8px;
        }
        #modalMermaidContainer svg {
            transition: transform 0.2s ease-out;
        }

        /* TTS Player Styles */
        .tts-player-card {
            padding-bottom: calc(var(--card-padding) + 10px); /* Extra padding for controls */
        }
        .tts-player-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px; /* Space between title and controls */
            align-items: center;
            justify-content: center; /* Center controls */
        }
        .tts-player-controls button {
            background-color: var(--accent-secondary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--card-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tts-player-controls button:hover {
            background-color: var(--accent-tertiary);
        }
        .tts-player-controls button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .tts-player-controls button i {
            margin-right: 6px;
        }
        .tts-status {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 10px;
            min-height: 1.2em; /* Reserve space for status message */
        }


        .wordcloud {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; 
            gap: 10px;
            padding: 20px 0;
        }

        .wordcloud-item {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .wordcloud-item:hover {
            transform: scale(1.1); 
        }

        .size-1 { font-size: 0.9rem; color: var(--text-secondary); }
        .size-2 { font-size: 1.1rem; color: var(--accent-cyan); }
        .size-3 { font-size: 1.3rem; color: var(--accent-blue); }
        .size-4 { font-size: 1.5rem; color: var(--accent-purple); }
        .size-5 { font-size: 1.8rem; color: var(--accent-tertiary); }
        
        .action-buttons-container {
            text-align: center;
            margin: 20px 0;
            padding-bottom: 20px; 
        }

        .action-button {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--card-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px 10px; 
            box-shadow: var(--card-shadow);
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
        }

        .action-button:hover {
            background-color: var(--accent-secondary);
            transform: translateY(-2px);
        }
         .action-button i {
            margin-right: 8px;
        }
        .action-button .fas { 
             margin-right: 8px;
        }


        .footer {
            margin-top: 30px; 
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        #report-content-wrapper .footer {
             margin-top: 30px; 
             padding-bottom: 20px; 
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card { animation: fadeIn 0.5s ease forwards; } 

        .main-card { animation-delay: 0.1s; }
        .tts-player-card { animation-delay: 0.15s; } /* Animation for TTS player */
        .topic-cards-wrapper .topic-card:nth-child(1) { animation-delay: 0.2s; }
        .topic-cards-wrapper .topic-card:nth-child(2) { animation-delay: 0.3s; }
        .topic-cards-wrapper .topic-card:nth-child(3) { animation-delay: 0.4s; }
        .topic-cards-wrapper .topic-card:nth-child(4) { animation-delay: 0.5s; } 
        
        .mindmap-card { animation-delay: 0.6s; } 

        .quote-card { animation-delay: 0.7s; } 
        .links-card { animation-delay: 0.8s; }
        .stats-card { animation-delay: 0.9s; }
        .wordcloud-card { animation-delay: 1.0s; }
        #report-content-wrapper .footer { animation-delay: 1.1s; } 
        .action-buttons-container { animation-delay: 1.2s; }


        @media (max-width: 768px) { 
            body {
                padding: 10px;
                font-size: 14px; 
            }

            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; } 
            h3 { font-size: 1.1rem; }

            .grid-container {
                grid-template-columns: 1fr; 
                grid-template-areas: 
                    "main"
                    "tts" /* TTS Player Area for mobile */
                    "topics"
                    "mindmap"
                    "quote"
                    "links"
                    "stats"
                    "wordcloud";
            }
            
            .topic-cards-wrapper {
                grid-template-columns: 1fr; 
            }
            .topic-card { 
                grid-column: 1 / -1;
                min-height: auto; 
            }
            .topic-card > .topic-card-content-wrapper {
                padding-bottom: 1rem; 
            }
            .topic-mentions { 
                position: static; 
                margin-top: 10px; 
                margin-bottom: 10px; 
                text-align: left; 
            }
            .card-icon { 
                position: relative; 
                bottom: auto;
                right: auto;
                margin-top: auto; 
                margin-left: auto; 
                padding-top: 10px; 
            }
            .user-stats-table th, .user-stats-table td {
                padding: 0.5rem 0.25rem; 
                font-size: 0.8rem; 
            }
            .user-stats-table .user-name-col,
            .user-stats-table .message-count-col,
            .user-stats-table .contribution-col {
                width: auto; 
            }
            .user-stats-table .message-count-col {
                 text-align: left; 
                 white-space: normal; /* Allow wrapping for count on mobile if needed */
            }
            .mindmap-controls {
                flex-wrap: wrap; 
            }
            .mindmap-controls button {
                font-size: 0.8rem;
                padding: 6px 10px;
            }
            .modal-content {
                width: 95vw;
                height: 85vh;
            }
            .tts-player-controls {
                flex-wrap: wrap; /* Allow TTS buttons to wrap */
                justify-content: center;
            }
            .tts-player-controls button {
                flex-basis: calc(33.33% - 10px); /* Roughly 3 buttons per row */
                margin-bottom: 5px;
            }


            .action-button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            .action-buttons-container {
                display: flex;
                flex-wrap: wrap; 
                justify-content: center; 
                gap: 10px; 
            }
            .action-buttons-container .action-button {
                 width: calc(50% - 10px); 
                 min-width: 180px; 
                 margin: 5px 0; 
            }
            @media (max-width: 480px) {
                .action-buttons-container .action-button {
                    width: 80%;
                }
                 .user-stats-table {
                    display: block; 
                    overflow-x: auto;
                 }
                .user-stats-table th, .user-stats-table td {
                    white-space: normal; 
                }
                .user-stats-table thead, .user-stats-table tbody, .user-stats-table tr {
                    display: block;
                }
                .user-stats-table tr {
                     border-bottom: 1px solid var(--bg-tertiary);
                }
                 .user-stats-table td:last-child {
                     border-bottom: none;
                 }
                .user-stats-table th {
                    display: none; 
                }
                .user-stats-table td {
                    display: block;
                    text-align: left !important; 
                    border-bottom: none;
                    padding-left: 0.5rem; 
                }
                .user-stats-table td::before { 
                    content: attr(data-label);
                    font-weight: bold;
                    display: inline-block;
                    width: 100px; 
                    margin-right: 10px;
                    color: var(--text-primary);
                }
                 .user-stats-table tr:last-child {
                    border-bottom: none;
                 }
                 .mindmap-controls {
                    justify-content: center;
                 }
                 .mindmap-controls button { /* Includes #openMindmapModalBtn */
                    width: calc(50% - 5px); 
                    margin-bottom: 5px;
                 }
                 .modal-mindmap-controls button {
                    width: calc(33.33% - 7px); /* Adjust for 3 buttons in a row */
                    margin-bottom: 5px;
                 }
                 .tts-player-controls button {
                    flex-basis: calc(50% - 5px); /* Two buttons per row on very small screens */
                 }


            }
        }
        #feedback-message {
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
        }
        #feedback-message.success {
            color: green;
        }
        #feedback-message.error {
            color: red;
        }
    </style>
</head>
<body>
    <div id="report-content-wrapper">
        <div class="grid-container">
            <div class="card main-card">
                <h1>[主报告标题 - 例如：AI产品团日报]</h1>
                <div class="date">[日期 - 例如：2025年5月19日]</div>
                <div class="meta-info">
                    <span><i class="fas fa-comment"></i> 消息数: [数字]+</span>
                    <span><i class="fas fa-users"></i> 活跃用户: [数字]+</span>
                    <span><i class="fas fa-fire"></i> 热点话题: [数字]</span>
                    <span><i class="fas fa-clock"></i> 统计时间: [时间范围]</span>
                </div>
                <p class="summary">[在此处填写当日讨论的总体摘要。保持简洁明了，突出群组的主要主题和氛围。]</p>
                <i class="fas fa-microchip card-icon"></i> 
            </div>

            <div class="card tts-player-card">
                <h2><i class="fas fa-bullhorn"></i> 日报摘要朗读</h2>
                <div class="tts-player-controls">
                    <button id="ttsPlayBtn"><i class="fas fa-play"></i> 播放</button>
                    <button id="ttsPauseBtn" disabled><i class="fas fa-pause"></i> 暂停</button>
                    <button id="ttsStopBtn" disabled><i class="fas fa-stop"></i> 停止</button>
                </div>
                <div class="tts-status" id="ttsStatus">准备就绪</div>
                 <i class="fas fa-headphones-alt card-icon"></i>
            </div>


            <div class="topic-cards-wrapper">
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-lightbulb"></i> [主题1标题]</h2>
                        <div class="topic-category">[分类1 - 例如：工具技巧]</div>
                        <p>关于<span class="highlight-keyword">插件功能</span>的讨论，特别是<span class="highlight-name">@用户A</span>提到的<span class="highlight-keyword">上下文处理</span>能力。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词1A]</span>
                            <span class="keyword">[关键词1B]</span>
                            <span class="keyword">[关键词1C]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量1]</div>
                    </div>
                    <i class="fas fa-tools card-icon"></i> 
                </div>

                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-rocket"></i> [主题2标题]</h2>
                        <div class="topic-category">[分类2 - 例如：新功能]</div>
                        <p><span class="highlight-name">@用户B</span>分享了<span class="highlight-keyword">AI搜索</span>的最新进展和<span class="highlight-keyword">地区限制</span>问题。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词2A]</span>
                            <span class="keyword">[关键词2B]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量2]</div>
                    </div>
                    <i class="fas fa-star card-icon"></i> 
                </div>
                
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper"> 
                        <h2><i class="fas fa-comments-dollar"></i> [主题3标题]</h2>
                        <div class="topic-category">[分类3 - 例如：工具体验]</div>
                        <p>大家对<span class="highlight-keyword">Agent技术</span>的<span class="highlight-keyword">商业化前景</span>进行了探讨，<span class="highlight-name">@用户C</span>提出了独到见解。</p>
                        <div class="topic-keywords">
                            <span class="keyword">[关键词3A]</span>
                            <span class="keyword">[关键词3B]</span>
                            <span class="keyword">[关键词3C]</span>
                        </div>
                        <div class="topic-mentions"><i class="fas fa-bullhorn"></i> 提及次数: [数量3]</div>
                    </div>
                    <i class="fas fa-comments card-icon"></i> 
                </div>
            </div>

            <div class="card mindmap-card">
                <h2><i class="fas fa-sitemap"></i> 核心概念关系图</h2>
                <div class="mindmap-controls">
                    <button id="zoomInBtn"><i class="fas fa-search-plus"></i> 放大</button>
                    <button id="zoomOutBtn"><i class="fas fa-search-minus"></i> 缩小</button>
                    <button id="downloadSvgBtn"><i class="fas fa-download"></i> 下载</button>
                    <button id="openMindmapModalBtn"><i class="fas fa-expand"></i> 全屏查看</button>
                </div>
                <div class="mermaid-container">
                    <div class="mermaid" id="mindmapDiagram">
                    mindmap
                      root((群聊核心主题))
                        ([主题1: NotebookLM技巧])
                          ([PageTalk插件讨论])
                          ([万能Prompt分享])
                        ([主题2: AI行业观察])
                          ([Google AI搜索])
                          ([Agent与工作流商业化])
                        ([主题3: 工具测评])
                          ([Google Imagen效果])
                          ([其他工具提及])
                    </div>
                </div>
                <i class="fas fa-project-diagram card-icon"></i>
            </div>

            <div class="card quote-card">
                <h2><i class="fas fa-quote-left"></i> 精彩引用</h2>
                <div class="quote">
                    "[引言1内容。使其具有影响力或代表性。]"
                    <div class="quote-author">- @[发言人1]</div>
                </div>
                <div class="quote">
                    "[引言2内容。]"
                    <div class="quote-author">- @[发言人2]</div>
                </div>
                <div class="quote">
                    "[引言3内容。]"
                    <div class="quote-author">- @[发言人3]</div>
                </div>
                <i class="fas fa-comment-dots card-icon"></i> 
            </div>

            <div class="card links-card">
                <h2><i class="fas fa-link"></i> 重要链接与资源</h2>
                <div class="link-item">
                     <a href="[URL链接1]" target="_blank">
                         <i class="fas fa-external-link-alt link-icon"></i> 
                         <span class="link-title">[链接1标题]</span>
                     </a>
                </div>
                <div class="link-item">
                     <a href="[URL链接2]" target="_blank">
                         <i class="fas fa-external-link-alt link-icon"></i>
                         <span class="link-title">[链接2标题]</span>
                     </a>
                </div>
                <div class="link-item">
                    <i class="fas fa-file link-icon"></i> 
                    <span class="link-title">[文档1标题 - 例如：共享提示词V5]</span> 
                    </div>
                <i class="fas fa-share-alt card-icon"></i> 
            </div>

            <div class="card stats-card">
                <h2><i class="fas fa-chart-line"></i> 活跃之星</h2>
                <table class="user-stats-table">
                    <thead>
                        <tr>
                            <th class="user-name-col">用户</th>
                            <th class="message-count-col">发言数</th>
                            <th class="contribution-col">主要贡献</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="用户">@发言人1</td>
                            <td data-label="发言数" class="message-count-col">[数量1]+</td>
                            <td data-label="主要贡献">[用户1的主要贡献内容 - 例如：分享 PageTalk 插件和万能 Prompt 生成器]</td>
                        </tr>
                        <tr>
                            <td data-label="用户">@发言人2</td>
                            <td data-label="发言数" class="message-count-col">[数量2]+</td>
                            <td data-label="主要贡献">[用户2的主要贡献内容 - 例如：PageTalk 插件开发者，分享使用体验]</td>
                        </tr>
                        <tr>
                            <td data-label="用户">@发言人3</td>
                            <td data-label="发言数" class="message-count-col">[数量3]+</td>
                            <td data-label="主要贡献">[用户3的主要贡献内容 - 例如：参与 Agent 讨论和工具测试]</td>
                        </tr>
                    </tbody>
                </table>
                <i class="fas fa-user-friends card-icon"></i> 
            </div>

            <div class="card wordcloud-card">
                <h2><i class="fas fa-cloud"></i> 词云</h2>
                <div class="wordcloud">
                    <span class="wordcloud-item size-5">[关键词A]</span>
                    <span class="wordcloud-item size-5">[关键词B]</span>
                    <span class="wordcloud-item size-4">[关键词C]</span>
                    <span class="wordcloud-item size-4">[关键词D]</span>
                    <span class="wordcloud-item size-3">[关键词E]</span>
                    <span class="wordcloud-item size-3">[关键词F]</span>
                    <span class="wordcloud-item size-2">[关键词G]</span>
                    <span class="wordcloud-item size-2">[关键词H]</span>
                    <span class="wordcloud-item size-1">[关键词I]</span>
                </div>
                <i class="fas fa-tags card-icon"></i> 
            </div>
        </div> 
        
        <div class="footer">
            <p>数据来源：[您的数据来源 - 例如：AI产品团聊天记录] | 生成时间：[生成日期] | 统计周期：[统计周期 - 例如：[日期]全天]</p>
            <p>[免责声明 - 例如：本报告由AI自动生成，仅供参考，不代表所有群成员观点。]</p>
        </div>
    </div> 

    <div id="mindmapModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>核心概念关系图</h3>
                <button id="modalCloseBtn" class="modal-close-btn" aria-label="关闭">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-mindmap-controls">
                    <button id="modalZoomInBtn"><i class="fas fa-search-plus"></i> 放大</button>
                    <button id="modalZoomOutBtn"><i class="fas fa-search-minus"></i> 缩小</button>
                    <button id="modalDownloadSvgBtn"><i class="fas fa-download"></i> 下载</button> 
                </div>
                <div id="modalMermaidContainer">
                    {/* SVG will be injected here by JavaScript */}
                </div>
            </div>
        </div>
    </div>

    <div class="action-buttons-container">
        <button id="viewPreviousReportBtn" class="action-button"><i class="fas fa-calendar-alt"></i> 查看昨日日报</button>
        <button id="screenshotToClipboardBtn" class="action-button"><i class="fas fa-clipboard"></i> 拷贝截图</button>
        <button id="screenshotDownloadBtn" class="action-button"><i class="fas fa-camera"></i> 下载截图</button>
        <button id="copyHtmlBtn" class="action-button"><i class="fas fa-copy"></i> 拷贝源码</button>
        <button id="downloadHtmlBtn" class="action-button"><i class="fas fa-download"></i> 下载报告</button>
    </div>
    <div id="feedback-message"></div>


    <script>
        // Initialize Mermaid.js
        mermaid.initialize({ startOnLoad: true, theme: 'base', fontFamily: '"Inter", sans-serif',
            mindmap: {
                padding: 15,
            }
        });

        let currentScale = 1; // For inline mindmap zoom
        let modalCurrentScale = 1; // For modal mindmap zoom
        
        function applyScaleToElement(svgElement, scale) {
            if (svgElement) {
                svgElement.style.transform = `scale(${scale})`;
                svgElement.style.transformOrigin = 'center center';
            }
        }

        // Inline Mindmap Zoom
        document.getElementById('zoomInBtn').addEventListener('click', function() {
            currentScale += 0.1;
            applyScaleToElement(document.querySelector('#mindmapDiagram svg'), currentScale);
        });

        document.getElementById('zoomOutBtn').addEventListener('click', function() {
            if (currentScale > 0.2) { 
                currentScale -= 0.1;
                applyScaleToElement(document.querySelector('#mindmapDiagram svg'), currentScale);
            }
        });
        
        function downloadSVGFromElement(svgElement, baseFilename) {
            if (svgElement) {
                const originalTransform = svgElement.style.transform;
                svgElement.style.transform = 'scale(1)'; 
                const svgData = new XMLSerializer().serializeToString(svgElement);
                svgElement.style.transform = originalTransform; 

                const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                let filename = baseFilename; 
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim().replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_') + '-' + baseFilename;
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim().replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_');
                }
                filename += '.svg'; 
                filename = filename.replace(/_+/g, '_');

                link.href = url;
                link.download = filename; 
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showFeedbackMessage(baseFilename + '已下载!', 'success'); 
            } else {
                showFeedbackMessage('无法下载：未找到' + baseFilename + '。', 'error'); 
            }
        }


        // Download Original SVG (from inline card)
        document.getElementById('downloadSvgBtn').addEventListener('click', function() {
            downloadSVGFromElement(document.querySelector('#mindmapDiagram svg'), '核心概念关系图');
        });

        // Mindmap Modal Logic
        const mindmapModal = document.getElementById('mindmapModal');
        const openMindmapModalBtn = document.getElementById('openMindmapModalBtn');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalMermaidContainer = document.getElementById('modalMermaidContainer');
        const modalDownloadSvgBtn = document.getElementById('modalDownloadSvgBtn'); 

        openMindmapModalBtn.addEventListener('click', function() {
            const originalSvgElement = document.querySelector('#mindmapDiagram svg');
            if (originalSvgElement) {
                modalMermaidContainer.innerHTML = ''; 
                const clonedSvg = originalSvgElement.cloneNode(true);
                clonedSvg.style.transform = 'scale(1)'; 
                clonedSvg.setAttribute('width', '100%'); 
                clonedSvg.setAttribute('height', '100%');
                clonedSvg.style.maxWidth = 'none'; 
                clonedSvg.style.maxHeight = 'none';
                modalMermaidContainer.appendChild(clonedSvg);
                modalCurrentScale = 1; 
                mindmapModal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; 
            } else {
                showFeedbackMessage('无法打开：未找到思维导图内容。', 'error');
            }
        });

        modalCloseBtn.addEventListener('click', function() {
            mindmapModal.style.display = 'none';
            modalMermaidContainer.innerHTML = ''; 
            document.body.style.overflow = 'auto'; 
        });

        window.addEventListener('click', function(event) {
            if (event.target === mindmapModal) {
                mindmapModal.style.display = 'none';
                modalMermaidContainer.innerHTML = '';
                document.body.style.overflow = 'auto';
            }
        });
        
        document.getElementById('modalZoomInBtn').addEventListener('click', function() {
            modalCurrentScale += 0.1;
            applyScaleToElement(document.querySelector('#modalMermaidContainer svg'), modalCurrentScale);
        });

        document.getElementById('modalZoomOutBtn').addEventListener('click', function() {
            if (modalCurrentScale > 0.2) {
                modalCurrentScale -= 0.1;
                applyScaleToElement(document.querySelector('#modalMermaidContainer svg'), modalCurrentScale);
            }
        });

        if (modalDownloadSvgBtn) { 
            modalDownloadSvgBtn.addEventListener('click', function() {
                downloadSVGFromElement(document.querySelector('#modalMermaidContainer svg'), '核心概念关系图-全屏');
            });
        }

        // TTS Player Logic
        const ttsPlayBtn = document.getElementById('ttsPlayBtn');
        const ttsPauseBtn = document.getElementById('ttsPauseBtn');
        const ttsStopBtn = document.getElementById('ttsStopBtn');
        const ttsStatus = document.getElementById('ttsStatus');
        let speechSynthesisInstance = window.speechSynthesis;
        let currentUtterance = null;

        // --- IMPORTANT: Define the text to be spoken here ---
        const reportSummaryText = `
            欢迎收听AI产品团日报。
            今日报告日期为[日期 - 例如：2025年5月19日]。
            消息总数超过[数字]+，活跃用户超过[数字]+，共产生[数字]个热点话题。
            总体摘要：[在此处填写当日讨论的总体摘要。保持简洁明了，突出群组的主要主题和氛围。]。
            主要热点话题包括：
            一：[主题1标题]，关于[分类1 - 例如：工具技巧]的讨论，例如[主题1简要描述]。
            二：[主题2标题]，关于[分类2 - 例如：新功能]的讨论，例如[主题2简要描述]。
            三：[主题3标题]，关于[分类3 - 例如：工具体验]的讨论，例如[主题3简要描述]。
            感谢您的收听。
        `;
        // --- End of text definition ---


        function updateTTSButtons(isPlaying, isPaused) {
            ttsPlayBtn.disabled = isPlaying && !isPaused;
            ttsPauseBtn.disabled = !isPlaying || isPaused;
            ttsStopBtn.disabled = !isPlaying && !isPaused;
        }

        if (speechSynthesisInstance) {
            ttsPlayBtn.addEventListener('click', function() {
                if (currentUtterance && speechSynthesisInstance.paused) {
                    speechSynthesisInstance.resume();
                    ttsStatus.textContent = '朗读中...';
                    updateTTSButtons(true, false);
                } else {
                    // Replace placeholders in reportSummaryText before speaking
                    let dynamicText = reportSummaryText;
                    try {
                        const mainTitle = document.querySelector('.main-card h1').textContent;
                        const dateText = document.querySelector('.main-card .date').textContent;
                        const summaryText = document.querySelector('.main-card .summary').textContent;
                        // Extract meta info - more robust parsing might be needed
                        const metaSpans = document.querySelectorAll('.main-card .meta-info span');
                        let messageCount = "[消息数]";
                        let activeUsers = "[活跃用户]";
                        let hotTopicsCount = "[热点话题数]";

                        metaSpans.forEach(span => {
                            if (span.textContent.includes('消息数')) messageCount = span.textContent.replace(/.*: /,'').replace('+','');
                            if (span.textContent.includes('活跃用户')) activeUsers = span.textContent.replace(/.*: /,'').replace('+','');
                            if (span.textContent.includes('热点话题')) hotTopicsCount = span.textContent.replace(/.*: /,'');
                        });
                        
                        // Extract topic details
                        let topicDetails = "";
                        const topicCards = document.querySelectorAll('.topic-card');
                        topicCards.forEach((card, index) => {
                            const title = card.querySelector('h2') ? card.querySelector('h2').textContent.replace(/^[^\s]+/, '').trim() : "[未知主题]";
                            const category = card.querySelector('.topic-category') ? card.querySelector('.topic-category').textContent : "[未知分类]";
                            const description = card.querySelector('p') ? card.querySelector('p').textContent : "[无描述]";
                            dynamicText = dynamicText.replace(`[主题${index+1}标题]`, title)
                                                 .replace(`[分类${index+1} - 例如：工具技巧]`, category)
                                                 .replace(`[主题${index+1}简要描述。]`, description.substring(0, 100) + (description.length > 100 ? "等等。" : ""));
                        });


                        dynamicText = dynamicText.replace('[在此处填写报告标题]', mainTitle)
                                             .replace('[日期 - 例如：2025年5月19日]', dateText)
                                             .replace('[在此处填写当日讨论的总体摘要。保持简洁明了，突出群组的主要主题和氛围。]', summaryText)
                                             .replace('[数字]+', messageCount) // Assuming first [数字]+ is message count
                                             .replace('[数字]+', activeUsers)  // Second is active users
                                             .replace('[数字]', hotTopicsCount); // Third is hot topics

                    } catch(e) {
                        console.warn("Could not fully populate TTS text from page content.", e);
                    }


                    currentUtterance = new SpeechSynthesisUtterance(dynamicText);
                    currentUtterance.lang = 'zh-CN'; // Set language for better pronunciation

                    currentUtterance.onstart = function() {
                        ttsStatus.textContent = '朗读中...';
                        updateTTSButtons(true, false);
                    };
                    currentUtterance.onpause = function() {
                        ttsStatus.textContent = '已暂停';
                        updateTTSButtons(true, true);
                    };
                    currentUtterance.onresume = function() {
                        ttsStatus.textContent = '朗读中...';
                        updateTTSButtons(true, false);
                    };
                    currentUtterance.onend = function() {
                        ttsStatus.textContent = '朗读完毕';
                        updateTTSButtons(false, false);
                        currentUtterance = null;
                    };
                    currentUtterance.onerror = function(event) {
                        ttsStatus.textContent = '朗读出错: ' + event.error;
                        updateTTSButtons(false, false);
                        currentUtterance = null;
                    };
                    speechSynthesisInstance.speak(currentUtterance);
                }
            });

            ttsPauseBtn.addEventListener('click', function() {
                if (speechSynthesisInstance.speaking && !speechSynthesisInstance.paused) {
                    speechSynthesisInstance.pause();
                }
            });

            ttsStopBtn.addEventListener('click', function() {
                if (speechSynthesisInstance.speaking || speechSynthesisInstance.pending) {
                    speechSynthesisInstance.cancel(); // Clears the queue and stops current speech
                    ttsStatus.textContent = '已停止';
                    updateTTSButtons(false, false);
                    currentUtterance = null;
                }
            });
            // Ensure buttons are reset if the page is reloaded while speech is active
            window.addEventListener('beforeunload', () => {
                if (speechSynthesisInstance && speechSynthesisInstance.speaking) {
                    speechSynthesisInstance.cancel();
                }
            });

        } else {
            ttsStatus.textContent = '您的浏览器不支持语音合成。';
            ttsPlayBtn.disabled = true;
            ttsPauseBtn.disabled = true;
            ttsStopBtn.disabled = true;
        }


        // =====================================================================================
        // 在这里配置昨日日报的URL
        // =====================================================================================
        const previousReportUrl = "在此处填写昨日日报的URL"; 

        function showFeedbackMessage(message, type = 'info', duration = 3000) {
            const feedbackElement = document.getElementById('feedback-message');
            if (feedbackElement) {
                feedbackElement.textContent = message;
                feedbackElement.className = type; 
                setTimeout(() => {
                    feedbackElement.textContent = '';
                    feedbackElement.className = '';
                }, duration);
            }
        }
        
        async function captureScreenshot(elementToCapture) {
            await document.fonts.ready;
            return html2canvas(elementToCapture, { 
                useCORS: true,
                scale: window.devicePixelRatio || 1,
                logging: false,
                backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-primary').trim() || '#f5f4ee',
                scrollX: -window.scrollX,
                scrollY: -window.scrollY,
                windowWidth: document.documentElement.scrollWidth,
                windowHeight: document.documentElement.scrollHeight
            });
        }

        document.getElementById('screenshotToClipboardBtn').addEventListener('click', async function() {
            const reportContent = document.getElementById('report-content-wrapper');
            if (!reportContent) {
                showFeedbackMessage('截图错误: 未找到报告内容。', 'error');
                return;
            }
            const actionButtons = document.querySelector('.action-buttons-container');
            const feedbackMsgElement = document.getElementById('feedback-message');
            const originalButtonText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 处理中...';
            this.disabled = true;
            actionButtons.style.visibility = 'hidden';
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';
            try {
                const canvas = await captureScreenshot(reportContent);
                canvas.toBlob(async function(blob) {
                    if (blob) {
                        try {
                            if (navigator.clipboard && navigator.clipboard.write) {
                                await navigator.clipboard.write([
                                    new ClipboardItem({ 'image/png': blob })
                                ]);
                                showFeedbackMessage('截图已拷贝到剪贴板!', 'success');
                            } else {
                                showFeedbackMessage('截图已生成，但您的浏览器不支持直接拷贝图片。请尝试下载截图。', 'error', 5000);
                            }
                        } catch (copyError) {
                            showFeedbackMessage('拷贝截图到剪贴板失败: ' + copyError.message, 'error', 5000);
                        }
                    } else {
                        throw new Error('无法将Canvas转换为Blob。');
                    }
                }, 'image/png');
            } catch (error) {
                showFeedbackMessage('截图捕获失败: ' + error.message, 'error');
            } finally {
                actionButtons.style.visibility = 'visible';
                if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';
                this.innerHTML = originalButtonText;
                this.disabled = false;
            }
        });

        document.getElementById('screenshotDownloadBtn').addEventListener('click', async function() {
            const reportContent = document.getElementById('report-content-wrapper');
            if (!reportContent) {
                showFeedbackMessage('截图错误: 未找到报告内容。', 'error');
                return;
            }
            const actionButtons = document.querySelector('.action-buttons-container');
            const feedbackMsgElement = document.getElementById('feedback-message');
            const originalButtonText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 生成中...';
            this.disabled = true;
            actionButtons.style.visibility = 'hidden';
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';
            try {
                const canvas = await captureScreenshot(reportContent);
                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                let filename = 'AI产品日报截图';
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim();
                } else {
                     const pageTitleTag = document.querySelector('title');
                     if (pageTitleTag && pageTitleTag.textContent.includes('-')) {
                         filename = pageTitleTag.textContent.split('-')[0].trim();
                     }
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim();
                }
                filename += '.png';
                filename = filename.replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_').replace(/_+/g, '_');
                link.href = image;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showFeedbackMessage('截图已下载!', 'success');
            } catch (error) {
                showFeedbackMessage('下载截图失败: ' + error.message, 'error');
            } finally {
                actionButtons.style.visibility = 'visible';
                if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';
                this.innerHTML = originalButtonText;
                this.disabled = false;
            }
        });

        document.getElementById('downloadHtmlBtn').addEventListener('click', function() {
            try {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const link = document.createElement('a');
                let filename = 'AI产品日报';
                const reportTitleElement = document.querySelector('.main-card h1');
                const reportDateElement = document.querySelector('.main-card .date');
                 if (reportTitleElement && reportTitleElement.textContent.trim() !== '[主报告标题 - 例如：AI产品团日报]') {
                    filename = reportTitleElement.textContent.trim();
                } else {
                     const pageTitleTag = document.querySelector('title');
                     if (pageTitleTag && pageTitleTag.textContent.includes('-')) {
                         filename = pageTitleTag.textContent.split('-')[0].trim();
                     }
                }
                if (reportDateElement && reportDateElement.textContent.trim() !== '[日期 - 例如：2025年5月19日]') {
                    filename += '-' + reportDateElement.textContent.trim();
                }
                filename += '.html';
                filename = filename.replace(/[^a-z0-9\u4e00-\u9fa5_\-\.]/gi, '_').replace(/_+/g, '_');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href); 
                showFeedbackMessage('HTML报告已下载!', 'success');
            } catch (error) {
                showFeedbackMessage('下载HTML失败: ' + error.message, 'error');
            }
        });

        document.getElementById('copyHtmlBtn').addEventListener('click', function() {
            const htmlContent = document.documentElement.outerHTML;
            const Gthis = this; 
            const originalButtonHTML = Gthis.innerHTML; 
            const textarea = document.createElement('textarea');
            textarea.value = htmlContent;
            textarea.style.position = 'fixed'; 
            textarea.style.top = '-9999px';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            try {
                textarea.select();
                textarea.setSelectionRange(0, textarea.value.length); 
                if (document.execCommand('copy')) {
                    Gthis.innerHTML = '<i class="fas fa-check"></i> 已拷贝!';
                    showFeedbackMessage('HTML已拷贝到剪贴板!', 'success', 2000);
                } else {
                    Gthis.innerHTML = '<i class="fas fa-times"></i> 拷贝失败';
                    showFeedbackMessage('拷贝失败。您的浏览器可能不支持此操作。', 'error', 2000);
                }
            } catch (err) {
                Gthis.innerHTML = '<i class="fas fa-times"></i> 拷贝出错';
                showFeedbackMessage('拷贝出错: ' + err.message, 'error', 2000);
            } finally {
                setTimeout(function() {
                    Gthis.innerHTML = originalButtonHTML; 
                }, 2000);
                document.body.removeChild(textarea);
            }
        });

        document.getElementById('viewPreviousReportBtn').addEventListener('click', function() {
            const urlToOpen = previousReportUrl.trim();
            const placeholderUrlText = "在此处填写昨日日报的URL";
            if (urlToOpen && urlToOpen !== placeholderUrlText && (urlToOpen.startsWith('http://') || urlToOpen.startsWith('https://') || !urlToOpen.includes('://'))) {
                let finalUrl = urlToOpen;
                const newWindow = window.open(finalUrl, '_blank');
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    showFeedbackMessage('无法打开新窗口。请检查您的弹出窗口拦截设置。', 'error', 5000);
                }
            } else {
                showFeedbackMessage('昨日日报的URL未配置或无效。请检查脚本中的 previousReportUrl 变量，并确保它是一个有效的网址或相对路径。', 'error', 5000);
            }
        });

        function adjustActionButtonsLayout() {
            const actionButtonsContainer = document.querySelector('.action-buttons-container');
            if (actionButtonsContainer) {
                if (window.innerWidth <= 768) {
                    actionButtonsContainer.style.display = 'flex';
                    actionButtonsContainer.style.flexWrap = 'wrap';
                    actionButtonsContainer.style.justifyContent = 'center';
                } else {
                    actionButtonsContainer.style.display = 'block'; 
                    actionButtonsContainer.style.flexWrap = 'nowrap'; 
                }
            }
        }
        window.addEventListener('load', adjustActionButtonsLayout);
        window.addEventListener('resize', adjustActionButtonsLayout);

    </script>
</body>
</html>
