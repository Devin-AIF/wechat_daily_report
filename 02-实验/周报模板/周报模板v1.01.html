<html lang="zh-CN" style="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘¨æŠ¥æ¨¡æ¿</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #f5f4ee;
            --bg-secondary: #faf9f6;
            --bg-tertiary: #f1f3f5;
            --text-primary: #212529;
            --text-secondary: #495057;
            --accent-primary: #ff8906;
            --accent-secondary: #f76707;
            --accent-tertiary: #e8590c;
            --accent-blue: #339af0;
            --accent-purple: #7048e8;
            --accent-cyan: #22b8cf;
            --highlight-keyword-bg: #ffe8cc;
            --highlight-name-color: #7048e8;
            --card-padding: 24px;
            --grid-gap: 16px;
            --card-radius: 12px;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --font-family: 'Inter', 'SF Pro Display', 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        body.modal-active {
            overflow: hidden;
        }

        h1, h2, h3, h4 {
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent-primary);
        }

        h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--accent-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--accent-blue);
        }
        h4 {
            font-size: 1.1rem;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            color: var(--accent-secondary);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: minmax(100px, auto);
            gap: var(--grid-gap);
            margin-top: 20px;
            grid-template-areas:
                "main    main    main    main    main    main    main    main    main    main    main    main"
                "topics  topics  topics  topics  topics  topics  topics  topics  topics  topics  topics  topics"
                "mindmap mindmap mindmap mindmap mindmap mindmap mindmap mindmap mindmap mindmap mindmap mindmap"
                "tools   tools   tools   tools   tools   tools   links   links   links   links   links   links"
                "stats   stats   stats   stats   stats   stats   stats   wordcloud wordcloud wordcloud wordcloud wordcloud"
                "trends  trends  trends  trends  trends  trends  trends  trends  trends  trends  trends  trends";
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-primary);
        }

        .card-icon {
            position: absolute;
            bottom: var(--card-padding);
            right: var(--card-padding);
            font-size: 4rem;
            opacity: 0.07;
            color: var(--accent-primary);
            z-index: 0;
        }

        .main-card { grid-area: main; }
        .topic-cards-wrapper {
            grid-area: topics;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: var(--grid-gap);
        }
        .mindmap-card-container { grid-area: mindmap; }
        .tools-card { grid-area: tools; }
        .links-card { grid-area: links; }
        .stats-card { grid-area: stats; }
        .wordcloud-card { grid-area: wordcloud; }
        .trends-card { grid-area: trends; }


        .topic-card {
            grid-column: span 6; /* Default to two columns */
            min-height: 250px;
        }
        .topic-card > .topic-card-content-wrapper {
            flex-grow: 1;
            padding-bottom: 1rem;
        }
        /* If there's an odd number of topic cards, the last one spans full width */
        .topic-cards-wrapper > .topic-card:nth-last-child(1):nth-child(odd) {
            grid-column: span 12;
        }

        .main-card h1 { text-align: center; }
        .main-card .date { text-align: center; }
        .date { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1rem; }
        .meta-info { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1rem; justify-content: center; }
        .meta-info span { background-color: var(--bg-tertiary); padding: 5px 10px; border-radius: 20px; font-size: 0.9rem; color: var(--accent-blue); display: inline-flex; align-items: center;}
        .meta-info span i { margin-right: 5px; }
        .summary { margin-top: 1rem; line-height: 1.7; text-align: left; }
        .topic-category { display: inline-block; background-color: var(--accent-tertiary); color: var(--bg-primary); padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 0.5rem; }
        .topic-keywords { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 0.75rem; margin-bottom: 0.75rem; }
        .keyword { background-color: var(--bg-tertiary); color: var(--accent-primary); padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; }
        .highlight-keyword { background-color: var(--highlight-keyword-bg); padding: 1px 2px; border-radius: 2px; font-weight: 500; display: inline; line-height: 1.2; box-decoration-break: clone; -webkit-box-decoration-break: clone; }
        .highlight-name { color: var(--highlight-name-color); font-weight: 500; }
        .topic-content p { margin-bottom: 0.5rem; color: var(--text-secondary);}
        .excerpt-block { margin-top: 1rem; padding-top: 0.75rem; border-top: 1px dashed var(--bg-tertiary); }
        .excerpt { position: relative; padding-left: 20px; margin: 5px 0; font-style: italic; color: var(--text-secondary); }
        .excerpt::before { content: '"'; position: absolute; left: 0; top: 0; font-size: 1.5rem; color: var(--accent-tertiary); }
        .excerpt-author { text-align: right; font-size: 0.9rem; color: var(--accent-tertiary); margin-top: 5px; }
        
        .link-item { display: flex; align-items: center; margin-bottom: 10px; padding: 8px; border-radius: 6px; background-color: var(--bg-tertiary); transition: background-color 0.2s ease; text-decoration: none; }
        .link-item:hover { background-color: rgba(51, 154, 240, 0.1); }
        .link-item a { text-decoration: none; color: inherit; display: flex; align-items: center; width: 100%; }
        .link-item a:hover .link-title { text-decoration: underline; color: var(--accent-blue); }
        .link-icon { margin-right: 10px; color: var(--accent-blue); }
        .link-title { flex-grow: 1; color: var(--text-primary); }
        .link-title.is-link { color: var(--accent-blue); }
        .link-title.is-link:hover { text-decoration: underline; }
        .links-card ul, .tools-card ul, .trends-card ul { list-style-type: none; padding-left: 0; }
        .links-card li, .tools-card li, .trends-card li { margin-bottom: 0.5rem; }
        .links-card ol { padding-left: 20px; margin-top: 0.5rem;}
        .links-card ol li { margin-bottom: 0.5rem; }

        .user-stats-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        .user-stats-table th { text-align: center; padding: 0.75rem 0.5rem; border-bottom: 2px solid var(--accent-primary); color: var(--text-primary); font-weight: 600; font-size: 0.9rem; }
        .user-stats-table td { padding: 0.75rem 0.5rem; border-bottom: 1px solid var(--bg-tertiary); color: var(--text-secondary); font-size: 0.85rem; vertical-align: top; text-align: left; }
        .user-stats-table .user-name-col { width: 25%; font-weight: 500; word-break: break-all; }
        .user-stats-table .message-count-col { text-align: center; width: 15%; white-space: nowrap; }
        .user-stats-table .contribution-col { width: 60%; word-break: break-all; }
        .user-stats-table tr:last-child td { border-bottom: none; }
        
        .wordcloud { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; padding: 20px 0; }
        .wordcloud-item { padding: 5px 10px; border-radius: 4px; font-weight: 500; transition: transform 0.2s ease; line-height: 1; }
        .wordcloud-item:hover { transform: scale(1.1); }
        .size-1 { font-size: 0.9rem; color: var(--text-secondary); }
        .size-2 { font-size: 1.1rem; color: var(--accent-cyan); }
        .size-3 { font-size: 1.3rem; color: var(--accent-blue); }
        .size-4 { font-size: 1.6rem; color: var(--accent-purple); }
        .size-5 { font-size: 2rem; color: var(--accent-tertiary); }
        
        .action-buttons-container { text-align: center; margin: 20px 0; padding-bottom: 20px; }
        .action-button { background-color: var(--accent-primary); color: white; border: none; padding: 10px 20px; border-radius: var(--card-radius); font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; margin: 5px 10px; box-shadow: var(--card-shadow); display: inline-flex; align-items: center; justify-content: center; }
        .action-button:hover { background-color: var(--accent-secondary); transform: translateY(-2px); }
        .action-button i, .action-button .fas, .action-button .fab { margin-right: 8px; }
        .footer { margin-top: 30px; text-align: center; color: var(--text-secondary); font-size: 0.9rem; }
        #report-content-wrapper .footer { margin-top: 30px; padding-bottom: 20px; }

        .mindmap-card { min-height: 400px; }
        .mindmap-card h2 i { margin-right: 8px; }
        .mindmap-controls { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; }
        .mindmap-controls button { background-color: var(--accent-blue); color: white; border: none; padding: 8px 12px; border-radius: var(--card-radius); font-size: 0.9rem; cursor: pointer; transition: background-color 0.2s ease; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; }
        .mindmap-controls button:hover { background-color: #228be6; }
        .mindmap-controls button i { margin-right: 5px; }
        .mindmap-controls .fullscreen-toggle-btn { margin-left: auto; }
        .mermaid-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; overflow: auto; background-color: #fff; border-radius: 8px; padding: 10px; border: 1px solid var(--bg-tertiary); min-height: 300px; cursor: grab; }
        .mermaid-container.dragging { cursor: grabbing; }
        .mermaid-container:empty::before { content: "åœ¨æ­¤å¤„ç”Ÿæˆæˆ–ç²˜è´´Mermaidå¯¼å›¾ä»£ç ã€‚"; color: var(--text-secondary); font-style: italic; text-align: center; padding: 20px; }
        .mermaid-container svg { max-width: none; height: auto; display: block; transition: transform 0.2s ease-out; }

        #mermaid-main-feedback-message, #mermaid-modal-feedback-message { text-align: center; margin-top: 15px; padding: 8px; border-radius: 4px; font-weight: 500; font-size: 0.9rem; display: none; }
        #mermaid-main-feedback-message.success, #mermaid-modal-feedback-message.success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; display: block; }
        #mermaid-main-feedback-message.error, #mermaid-modal-feedback-message.error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; display: block; }
        #mermaid-main-feedback-message.info, #mermaid-modal-feedback-message.info { color: #0c5460; background-color: #d1ecf1; border: 1px solid #bee5eb; display: block; }
        
        #feedback-message { text-align: center; margin-top: 10px; font-weight: 500; }
        #feedback-message.success { color: green; }
        #feedback-message.error { color: red; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.75); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal-content { width: 95%; height: 90%; max-width: 1200px; }
        .modal-close-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 2.2rem; color: var(--text-secondary); cursor: pointer; line-height: 1; padding: 5px; z-index: 1010; }
        .modal-close-btn:hover { color: var(--text-primary); }
        #modalMermaidContainer { flex-grow: 1; min-height: 0; }
        #modalMermaidContainer:empty::before { content: "å¯¼å›¾å†…å®¹å°†åœ¨æ­¤æ˜¾ç¤ºã€‚"; color: var(--text-secondary); font-style: italic; text-align: center; padding: 20px; display: flex; justify-content: center; align-items: center; height: 100%; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card { animation: fadeIn 0.5s ease forwards; }
        .main-card { animation-delay: 0.1s; }
        .topic-cards-wrapper .topic-card:nth-child(1) { animation-delay: 0.2s; }
        .topic-cards-wrapper .topic-card:nth-child(2) { animation-delay: 0.3s; }
        .trends-card { animation-delay: 1.1s; }
        #report-content-wrapper .footer { animation: fadeIn 0.5s ease forwards; animation-delay: 1.2s; }
        .action-buttons-container { animation: fadeIn 0.5s ease forwards; animation-delay: 1.3s; }

        @media (max-width: 768px) {
            body { padding: 10px; font-size: 14px; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; }
            h3 { font-size: 1.1rem; }
            .grid-container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "main"
                    "topics"
                    "mindmap"
                    "tools"
                    "links"
                    "stats"
                    "wordcloud"
                    "trends";
            }
            .topic-cards-wrapper { grid-template-columns: 1fr; }
            .topic-card { grid-column: 1 / -1; min-height: auto; }
            .topic-card > .topic-card-content-wrapper { padding-bottom: 1rem; }
            .card-icon { font-size: 2.5rem; opacity:0.05; }
            .user-stats-table th, .user-stats-table td { padding: 0.5rem 0.25rem; font-size: 0.8rem; }
            .action-button { padding: 8px 15px; font-size: 0.9rem; }
            .action-buttons-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
            .action-buttons-container .action-button { width: calc(50% - 10px); min-width: 180px; margin: 5px 0; }
            .mindmap-card .card { padding: 15px; }
            .mindmap-controls button { font-size: 0.8rem; padding: 6px 10px; }
            .modal-content { width: 100%; height: 95%; }
            .modal-close-btn { font-size: 1.8rem; top:10px; right:10px;}
        }
        @media (max-width: 480px) {
            .action-buttons-container .action-button { width: 80%; }
            .user-stats-table { display: block; overflow-x: auto; }
            .user-stats-table th, .user-stats-table td { white-space: normal; }
            .user-stats-table thead, .user-stats-table tbody, .user-stats-table tr { display: block; }
            .user-stats-table tr { border-bottom: 1px solid var(--bg-tertiary); }
            .user-stats-table th { display: none; }
            .user-stats-table td { display: block; text-align: left; border-bottom: none; padding-left: 0.5rem; }
            .user-stats-table td.message-count-col { text-align: left; }
            .user-stats-table td::before { content: attr(data-label); font-weight: bold; display: inline-block; width: 100px; margin-right: 10px; color: var(--text-primary); text-align: left; }
            .user-stats-table tr:last-child { border-bottom: none; }
        }
    </style>
</head>
<body style="">
    <div id="report-content-wrapper">
        <div class="grid-container">
            <div class="card main-card">
                <h1>[åœ¨æ­¤å¤„å¡«å†™å‘¨æŠ¥æ ‡é¢˜]</h1>
                <div class="date">[åœ¨æ­¤å¤„å¡«å†™æ—¥æœŸèŒƒå›´]</div>
                <div class="meta-info">
                    <span><i class="fas fa-users"></i> ç¾¤åç§°: [ç¾¤åç§°]</span>
                    <span><i class="fas fa-comment"></i> æ¶ˆæ¯æ€»æ•°: [æ•°é‡]æ¡</span>
                    <span><i class="fas fa-user-check"></i> æ´»è·ƒç”¨æˆ·: [æ•°é‡]äºº</span>
                    <span><i class="fas fa-fire"></i> çƒ­ç‚¹è¯é¢˜: [æ•°é‡]ä¸ª</span>
                    </div>
                <p class="summary">[åœ¨æ­¤å¤„å¡«å†™å‘¨æŠ¥æ‘˜è¦]</p>
                <i class="fas fa-calendar-week card-icon"></i>
            </div>

            <div class="topic-cards-wrapper">
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper">
                        <h2><i class="fas fa-lightbulb"></i> [åœ¨æ­¤å¤„å¡«å†™è¯é¢˜æ ‡é¢˜1]</h2>
                        <div class="topic-category">[è¯é¢˜åˆ†ç±»]</div>
                        <div class="topic-content">
                            <p>[åœ¨æ­¤å¤„å¡«å†™è¯é¢˜å†…å®¹è¯¦æƒ…...]</p>
                        </div>
                        <div class="topic-keywords">
                            <span class="keyword">[å…³é”®è¯1]</span>
                            <span class="keyword">[å…³é”®è¯2]</span>
                            </div>
                        <div class="excerpt-block">
                            <div class="excerpt">"[åœ¨æ­¤å¤„å¡«å†™å¼•ç”¨å†…å®¹]"</div>
                            <div class="excerpt-author">- [å¼•ç”¨ä½œè€…]</div>
                        </div>
                    </div>
                    <i class="fas fa-lightbulb card-icon"></i> </div>
                <div class="card topic-card">
                    <div class="topic-card-content-wrapper">
                        <h2><i class="fas fa-comments"></i> [åœ¨æ­¤å¤„å¡«å†™è¯é¢˜æ ‡é¢˜2]</h2>
                        <div class="topic-category">[è¯é¢˜åˆ†ç±»]</div>
                        <div class="topic-content">
                            <p>[åœ¨æ­¤å¤„å¡«å†™è¯é¢˜å†…å®¹è¯¦æƒ…...]</p>
                        </div>
                        <div class="topic-keywords">
                            <span class="keyword">[å…³é”®è¯A]</span>
                            <span class="keyword">[å…³é”®è¯B]</span>
                        </div>
                        <div class="excerpt-block">
                            <div class="excerpt">"[åœ¨æ­¤å¤„å¡«å†™å¦ä¸€æ®µå¼•ç”¨å†…å®¹]"</div>
                            <div class="excerpt-author">- [å¦ä¸€ä½å¼•ç”¨ä½œè€…]</div>
                        </div>
                    </div>
                    <i class="fas fa-comments card-icon"></i>
                </div>
            </div>
            
            <div class="mindmap-card-container card"> 
                <div class="mindmap-card"> 
                    <h2><i class="fas fa-sitemap"></i> æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾</h2>
                    <div class="mindmap-controls">
                        <button id="zoomInBtn"><i class="fas fa-search-plus"></i> æ”¾å¤§</button>
                        <button id="zoomOutBtn"><i class="fas fa-search-minus"></i> ç¼©å°</button>
                        <button id="downloadDiagramBtn"><i class="fas fa-download"></i> ä¸‹è½½å¯¼å›¾</button>
                        <button id="fullscreenOpenBtn" class="fullscreen-toggle-btn"><i class="fas fa-expand"></i> å…¨å±</button> 
                    </div>
                    <div class="mermaid-container" id="mainMermaidContainer">
                        </div>
                    <div id="mermaid-main-feedback-message"></div>
                    <i class="fas fa-project-diagram card-icon"></i>
                </div>
            </div>

            <div class="card tools-card"> 
                <h2><i class="fas fa-tools"></i> ğŸ› ï¸ å®ç”¨å·¥å…·ä¸æŠ€å·§æ¨è</h2>
                <h4><i class="fas fa-robot"></i> AIå¹³å°å·¥å…·</h4>
                <ul>
                    <li>[å·¥å…·1åç§°] - [ç®€çŸ­æè¿°]</li>
                    <li>[å·¥å…·2åç§°] - [ç®€çŸ­æè¿°]</li>
                    </ul>
                <h4><i class="fas fa-code-branch"></i> å¼€å‘å·¥å…·</h4>
                <ul>
                    <li>[å¼€å‘å·¥å…·1] - [ç®€çŸ­æè¿°]</li>
                    </ul>
                <h4><i class="fas fa-tags"></i> è®¢é˜…ä¼˜åŒ–</h4>
                <ul>
                    <li>[è®¢é˜…æŠ€å·§1] - [ç®€çŸ­æè¿°]</li>
                    </ul>
                <i class="fas fa-toolbox card-icon"></i> 
            </div>

            <div class="card links-card">
                <h2><i class="fas fa-link"></i> ğŸ”— é‡è¦èµ„æºé“¾æ¥ä¸è§£å†³æ–¹æ¡ˆ</h2>
                <h4><i class="fas fa-external-link-alt"></i> é‡è¦èµ„æºé“¾æ¥æ±‡æ€»</h4>
                <ul>
                    <li class="link-item"><a href="#" target="_blank"><i class="fas fa-link link-icon"></i> <span class="link-title is-link">[èµ„æºé“¾æ¥1æ ‡é¢˜]</span></a></li>
                    <li class="link-item"><a href="#" target="_blank"><i class="fas fa-link link-icon"></i> <span class="link-title is-link">[èµ„æºé“¾æ¥2æ ‡é¢˜]</span></a></li>
                    </ul>
                <h3 style="margin-top: 1.5rem;"><i class="fas fa-wrench"></i> ğŸ”§ æŠ€æœ¯é—®é¢˜è§£å†³æ–¹æ¡ˆè®°å½•</h3>
                <ol>
                    <li><strong>[é—®é¢˜1æ ‡é¢˜]</strong>
                        <ul><li>é—®é¢˜ï¼š [é—®é¢˜æè¿°]</li><li>è§£å†³æ–¹æ¡ˆï¼š [è§£å†³æ–¹æ¡ˆæè¿°]</li></ul>
                    </li>
                    </ol>
                <i class="fas fa-share-alt card-icon"></i> 
            </div>

            <div class="card stats-card">
                <h2><i class="fas fa-star"></i> ğŸ‘¥ æ´»è·ƒç”¨æˆ·</h2>
                <table class="user-stats-table">
                    <thead>
                        <tr>
                            <th class="user-name-col">ç”¨æˆ·</th>
                            <th class="message-count-col">å‘è¨€æ•°</th>
                            <th class="contribution-col">ä¸»è¦è´¡çŒ®</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="ç”¨æˆ·" class="user-name-col">[ç”¨æˆ·æ˜µç§°1]</td>
                            <td data-label="å‘è¨€æ•°" class="message-count-col">[æ•°é‡]</td>
                            <td data-label="ä¸»è¦è´¡çŒ®" class="contribution-col">[è´¡çŒ®æè¿°]</td>
                        </tr>
                        <tr>
                            <td data-label="ç”¨æˆ·" class="user-name-col">[ç”¨æˆ·æ˜µç§°2]</td>
                            <td data-label="å‘è¨€æ•°" class="message-count-col">[æ•°é‡]</td>
                            <td data-label="ä¸»è¦è´¡çŒ®" class="contribution-col">[è´¡çŒ®æè¿°]</td>
                        </tr>
                        </tbody>
                </table>
                <i class="fas fa-user-friends card-icon"></i> 
            </div>

            <div class="card wordcloud-card">
                <h2><i class="fas fa-cloud"></i> è¯äº‘</h2>
                <div class="wordcloud">
                    <span class="wordcloud-item size-5">[ä¸»è¦è¯1]</span>
                    <span class="wordcloud-item size-4">[ä¸»è¦è¯2]</span>
                    <span class="wordcloud-item size-3">[æ¬¡è¦è¯1]</span>
                    <span class="wordcloud-item size-2">[æ¬¡è¦è¯2]</span>
                    <span class="wordcloud-item size-1">[æ™®é€šè¯1]</span>
                </div>
                <i class="fas fa-tags card-icon"></i> 
            </div>

            <div class="card trends-card">
                <h2><i class="fas fa-binoculars"></i> ğŸ“ˆ è¶‹åŠ¿è§‚å¯Ÿ</h2>
                <h4><i class="fas fa-cogs"></i> æŠ€æœ¯å‘å±•è¶‹åŠ¿</h4>
                <ul>
                    <li>[è¶‹åŠ¿1æè¿°]</li>
                    <li>[è¶‹åŠ¿2æè¿°]</li>
                    </ul>
                <h4><i class="fas fa-store"></i> å¸‚åœºå˜åŒ–</h4>
                <ul>
                    <li>[å¸‚åœºå˜åŒ–1æè¿°]</li>
                    </ul>
                <h4><i class="fas fa-users-cog"></i> ç”¨æˆ·è¡Œä¸º</h4>
                <ul>
                    <li>[ç”¨æˆ·è¡Œä¸º1æè¿°]</li>
                    </ul>
                <i class="fas fa-chart-area card-icon"></i>
            </div>
        </div> 
        
        <div class="footer">
            <p>æ•°æ®æ¥æºï¼š [æ•°æ®æ¥æº] | ç”Ÿæˆæ—¥æœŸï¼š [ç”Ÿæˆæ—¥æœŸ] | ç»Ÿè®¡å‘¨æœŸï¼š [ç»Ÿè®¡å‘¨æœŸ]</p>
            <p>æœ¬æŠ¥å‘Šç”±AIè¾…åŠ©ç”Ÿæˆï¼Œå†…å®¹æ ¹æ®æä¾›æ–‡æœ¬æ•´ç†ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
        </div>
    </div> 

    <div class="action-buttons-container">
        <button id="screenshotToClipboardBtn" class="action-button"><i class="fas fa-clipboard"></i> æ‹·è´æˆªå›¾</button>
        <button id="screenshotDownloadBtn" class="action-button"><i class="fas fa-camera"></i> ä¸‹è½½æˆªå›¾</button>
        <button id="copyHtmlBtn" class="action-button"><i class="fas fa-copy"></i> æ‹·è´æºç </button>
        <button id="downloadHtmlBtn" class="action-button"><i class="fas fa-download"></i> ä¸‹è½½æŠ¥å‘Š</button>
        <button id="viewPreviousReportBtn" class="action-button"><i class="fas fa-calendar-alt"></i> æŸ¥çœ‹ä¸Šå‘¨å‘¨æŠ¥</button>
    </div>
    <div id="feedback-message" class=""></div> 

    <div id="fullscreenModal" class="modal-overlay">
        <div class="modal-content card"> 
            <button id="fullscreenCloseBtn" class="modal-close-btn" aria-label="å…³é—­å…¨å±">Ã—</button>
            <h2><i class="fas fa-sitemap"></i> æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾ (å…¨å±)</h2>
            <div class="mindmap-controls">
                <button id="modalZoomInBtn"><i class="fas fa-search-plus"></i> æ”¾å¤§</button>
                <button id="modalZoomOutBtn"><i class="fas fa-search-minus"></i> ç¼©å°</button>
                <button id="modalDownloadDiagramBtn"><i class="fas fa-download"></i> ä¸‹è½½å¯¼å›¾</button>
            </div>
            <div class="mermaid-container" id="modalMermaidContainer"></div>
            <div id="mermaid-modal-feedback-message"></div>
        </div>
    </div>

    <script>
    // --- Mermaid Diagram JavaScript START ---
    let mainCurrentScale = 1;
    let modalCurrentScale = 1;
    let currentMindmapDefinition = `
mindmap
  root((å‘¨æŠ¥æ ¸å¿ƒ))
    ((ä¸»è¦è®®é¢˜1))
      (å­è®®é¢˜A)
      (å­è®®é¢˜B)
    ((ä¸»è¦è®®é¢˜2))
      (å­è®®é¢˜C)
      (å­è®®é¢˜D)
    ((å…³é”®æ•°æ®))
    ((è¶‹åŠ¿è§‚å¯Ÿ))
    ((å·¥å…·æ¨è))
    `; // Default or example mindmap

    const mainZoomInBtn = document.getElementById('zoomInBtn');
    const mainZoomOutBtn = document.getElementById('zoomOutBtn');
    const mainDownloadDiagramBtn = document.getElementById('downloadDiagramBtn');
    const mainMermaidContainer = document.getElementById('mainMermaidContainer');
    const mermaidMainFeedbackMessage = document.getElementById('mermaid-main-feedback-message');
    // const mainMindmapDiagramDiv = document.getElementById('mindmapDiagram'); // Not used if definition is in JS

    const fullscreenOpenBtn = document.getElementById('fullscreenOpenBtn');
    const fullscreenModal = document.getElementById('fullscreenModal');
    const fullscreenCloseBtn = document.getElementById('fullscreenCloseBtn');
    const modalMermaidContainer = document.getElementById('modalMermaidContainer');
    const modalZoomInBtn = document.getElementById('modalZoomInBtn');
    const modalZoomOutBtn = document.getElementById('modalZoomOutBtn');
    const modalDownloadDiagramBtn = document.getElementById('modalDownloadDiagramBtn');
    const mermaidModalFeedbackMessage = document.getElementById('mermaid-modal-feedback-message');

    if (typeof mermaid !== 'undefined') {
        mermaid.initialize({
            startOnLoad: false, 
            theme: 'base', 
            fontFamily: '"Inter", sans-serif',
            mindmap: { padding: 15, useMaxWidth: false }
        });
    } else {
        console.error("Mermaid library not loaded.");
        if(mermaidMainFeedbackMessage) mermaidMainFeedbackMessage.textContent = "é”™è¯¯ï¼šMermaidåº“æœªèƒ½åŠ è½½ã€‚";
    }
    
    function showMermaidFeedback(element, message, type = 'info', duration = 3000) {
        if (element) {
            element.textContent = message;
            element.className = type; 
            element.style.display = 'block';
            setTimeout(() => {
                element.textContent = '';
                element.className = '';
                element.style.display = 'none';
            }, duration);
        }
    }

    function applySvgScale(svgElement, scale) {
        if (svgElement) {
            svgElement.style.transform = `scale(${scale})`;
            svgElement.style.transformOrigin = 'center center';
        }
    }

    function makeDraggable(containerElement) {
        let isDragging = false;
        let startX, startY, scrollLeftStart, scrollTopStart;

        if (!containerElement) return;

        containerElement.addEventListener('mousedown', (e) => {
            if (e.button !== 0) return; 
            if (e.target.closest('button') || e.target.closest('a') || e.target.closest('[onclick]')) return;
            
            if (e.target === containerElement || e.target.closest('svg')) { // Allow dragging on SVG too
                const verticalScrollbarVisible = containerElement.scrollHeight > containerElement.clientHeight;
                const horizontalScrollbarVisible = containerElement.scrollWidth > containerElement.clientWidth;
                const clickedOnVerticalScrollbar = verticalScrollbarVisible && e.offsetX >= containerElement.clientWidth - 17; 
                const clickedOnHorizontalScrollbar = horizontalScrollbarVisible && e.offsetY >= containerElement.clientHeight - 17;
                if (clickedOnVerticalScrollbar || clickedOnHorizontalScrollbar) return;
            
                isDragging = true;
                startX = e.pageX; startY = e.pageY;
                scrollLeftStart = containerElement.scrollLeft; scrollTopStart = containerElement.scrollTop;
                containerElement.classList.add('dragging');
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault(); 
            const deltaX = e.pageX - startX; const deltaY = e.pageY - startY;
            containerElement.scrollLeft = scrollLeftStart - deltaX;
            containerElement.scrollTop = scrollTopStart - deltaY;
        });

        document.addEventListener('mouseup', (e) => {
            if (e.button !== 0 || !isDragging) return;
            isDragging = false;
            containerElement.classList.remove('dragging');
        });
        
        containerElement.addEventListener('touchstart', (e) => {
            if (e.target.closest('button') || e.target.closest('a') || e.target.closest('[onclick]')) return;
             if (e.touches.length === 1 && (e.target === containerElement || e.target.closest('svg'))) {
                isDragging = true;
                const touch = e.touches[0];
                startX = touch.pageX;
                startY = touch.pageY;
                scrollLeftStart = containerElement.scrollLeft;
                scrollTopStart = containerElement.scrollTop;
                containerElement.classList.add('dragging');
            }
        }, { passive: true }); 

        document.addEventListener('touchmove', (e) => {
            if (!isDragging || e.touches.length !== 1) return;
            const touch = e.touches[0];
            const deltaX = touch.pageX - startX;
            const deltaY = touch.pageY - startY;
            containerElement.scrollLeft = scrollLeftStart - deltaX;
            containerElement.scrollTop = scrollTopStart - deltaY;
        }); 

        document.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            isDragging = false;
            containerElement.classList.remove('dragging');
        });
    }
    
    async function downloadMermaidAsSVG(svgElement, baseFilename, feedbackElem) {
        if (svgElement && svgElement.innerHTML.trim() !== "") {
            try {
                const svgData = new XMLSerializer().serializeToString(svgElement);
                const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${baseFilename}.svg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showMermaidFeedback(feedbackElem, `${baseFilename}.svg å·²ä¸‹è½½!`, 'success');
            } catch (error) {
                console.error(`Error during SVG download for ${baseFilename}:`, error);
                showMermaidFeedback(feedbackElem, `ä¸‹è½½ ${baseFilename}.svg å¤±è´¥: ${error.message}`, 'error');
            }
        } else {
            showMermaidFeedback(feedbackElem, 'æ— æ³•ä¸‹è½½ï¼šå›¾è¡¨å†…å®¹ä¸ºç©ºã€‚', 'error');
        }
    }

    async function renderDiagram(definition, targetContainer, scaleVariableRef, feedbackElem, uniqueSvgId) {
        if (!targetContainer) {
            console.error("Target container for Mermaid diagram not found.");
            return null;
        }
        targetContainer.innerHTML = '<p style="text-align:center; padding:20px;">å›¾è¡¨åŠ è½½ä¸­...</p>';
        targetContainer.classList.remove('empty');

        if (!definition || definition.trim() === "" || definition.trim().toLowerCase() === "mindmap") {
            targetContainer.innerHTML = ''; 
            targetContainer.classList.add('empty'); 
            return null;
        }
        
        // currentMindmapDefinition = definition; // Already set globally or passed

        try {
            if (typeof mermaid === 'undefined') throw new Error("Mermaid library is not available.");
            const {svg, bindFunctions} = await mermaid.render(uniqueSvgId, definition);
            targetContainer.innerHTML = svg;
            if (bindFunctions) bindFunctions(targetContainer);

            const svgElement = targetContainer.querySelector('svg');
            if (svgElement) {
                // Reset scale to 1 for new renders, or use existing if just updating
                if (targetContainer === mainMermaidContainer) mainCurrentScale = scaleVariableRef.value || 1;
                else if (targetContainer === modalMermaidContainer) modalCurrentScale = scaleVariableRef.value || 1;
                
                applySvgScale(svgElement, scaleVariableRef.value || 1); 
                makeDraggable(targetContainer); 
                return svgElement;
            } else {
                targetContainer.innerHTML = '';
                targetContainer.classList.add('empty');
                showMermaidFeedback(feedbackElem, 'å›¾è¡¨ç”Ÿæˆäº†ï¼Œä½†æœªæ‰¾åˆ°SVGå†…å®¹ã€‚', 'error');
                return null;
            }
        } catch (error) {
            console.error("Error rendering Mermaid:", error);
            targetContainer.innerHTML = `<p style="color:red; text-align:center; padding:20px;">æ¸²æŸ“å›¾è¡¨æ—¶å‡ºé”™: ${error.message}</p>`;
            showMermaidFeedback(feedbackElem, `æ¸²æŸ“å›¾è¡¨æ—¶å‡ºé”™: ${error.message}`, 'error', 5000);
            return null;
        }
    }

    if(mainZoomInBtn) mainZoomInBtn.addEventListener('click', () => {
        mainCurrentScale += 0.1;
        const svg = mainMermaidContainer.querySelector('svg');
        applySvgScale(svg, mainCurrentScale);
    });

    if(mainZoomOutBtn) mainZoomOutBtn.addEventListener('click', () => {
        if (mainCurrentScale > 0.2) { 
            mainCurrentScale -= 0.1;
            const svg = mainMermaidContainer.querySelector('svg');
            applySvgScale(svg, mainCurrentScale);
        }
    });

    if(mainDownloadDiagramBtn) mainDownloadDiagramBtn.addEventListener('click', () => {
        const svg = mainMermaidContainer.querySelector('svg');
        downloadMermaidAsSVG(svg, 'æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾', mermaidMainFeedbackMessage);
    });

    if(fullscreenOpenBtn) fullscreenOpenBtn.addEventListener('click', async () => {
        if (!currentMindmapDefinition || currentMindmapDefinition.trim() === "" || currentMindmapDefinition.trim().toLowerCase() === "mindmap") {
            showMermaidFeedback(mermaidMainFeedbackMessage, 'è¯·å…ˆåœ¨ä¸»åŒºåŸŸå®šä¹‰ä¸€ä¸ªæœ‰æ•ˆçš„å¯¼å›¾æ‰èƒ½å…¨å±æŸ¥çœ‹ã€‚', 'info');
            return;
        }
        if(fullscreenModal) fullscreenModal.classList.add('active');
        document.body.classList.add('modal-active');
        modalCurrentScale = mainCurrentScale; // Sync scale from main view
        await renderDiagram(currentMindmapDefinition, modalMermaidContainer, {value: modalCurrentScale}, mermaidModalFeedbackMessage, 'modalGeneratedSvgId');
    });

    if(fullscreenCloseBtn) fullscreenCloseBtn.addEventListener('click', () => {
        if(fullscreenModal) fullscreenModal.classList.remove('active');
        document.body.classList.remove('modal-active');
        if(modalMermaidContainer) {
            modalMermaidContainer.innerHTML = ''; 
            modalMermaidContainer.classList.add('empty');
        }
    });

    if(modalZoomInBtn) modalZoomInBtn.addEventListener('click', () => {
        modalCurrentScale += 0.1;
        const svg = modalMermaidContainer.querySelector('svg');
        applySvgScale(svg, modalCurrentScale);
    });

    if(modalZoomOutBtn) modalZoomOutBtn.addEventListener('click', () => {
        if (modalCurrentScale > 0.2) {
            modalCurrentScale -= 0.1;
            const svg = modalMermaidContainer.querySelector('svg');
            applySvgScale(svg, modalCurrentScale);
        }
    });

    if(modalDownloadDiagramBtn) modalDownloadDiagramBtn.addEventListener('click', () => {
        const svg = modalMermaidContainer.querySelector('svg');
        downloadMermaidAsSVG(svg, 'æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾-å…¨å±', mermaidModalFeedbackMessage);
    });

    async function initializeMainDiagram() {
        // For the template, we render the default/example mindmap
        if (mainMermaidContainer) {
             await renderDiagram(currentMindmapDefinition, mainMermaidContainer, { value: mainCurrentScale }, mermaidMainFeedbackMessage, 'initialMainDiagramSvg');
        } else {
            if(mermaidMainFeedbackMessage) showMermaidFeedback(mermaidMainFeedbackMessage, 'é”™è¯¯ï¼šå¯¼å›¾å®¹å™¨æœªæ‰¾åˆ°ã€‚', 'error');
        }
    }
    // --- Mermaid Diagram JavaScript END ---


    // --- Report Page JavaScript START ---
    function getCssVariable(variableName, defaultValue = null) {
        const value = getComputedStyle(document.documentElement).getPropertyValue(variableName).trim();
        return value || defaultValue;
    }

    function getWebpageNameForFilename() {
        const pageTitleTag = document.querySelector('title');
        let baseName = 'å‘¨æŠ¥'; // Default for template
        if (pageTitleTag && pageTitleTag.textContent && pageTitleTag.textContent.trim() !== "å‘¨æŠ¥æ¨¡æ¿") {
            const fullTitle = pageTitleTag.textContent.trim();
            const titleParts = fullTitle.split(' - '); 
            if (titleParts.length > 0 && titleParts[0].trim() !== "") {
                baseName = titleParts[0].trim(); 
            }
        }
        return baseName;
    }

    function getDateStringForFilename() {
        const reportDateElement = document.querySelector('.main-card .date');
        let dateStr = "æœªæŒ‡å®šæ—¥æœŸ"; 
        if (reportDateElement && reportDateElement.textContent && reportDateElement.textContent.trim() !== "[åœ¨æ­¤å¤„å¡«å†™æ—¥æœŸèŒƒå›´]") {
            dateStr = reportDateElement.textContent.trim();
        } else {
            // Generate current date if placeholder is still there
            const today = new Date();
            dateStr = `${today.getFullYear()}å¹´${String(today.getMonth() + 1).padStart(2, '0')}æœˆ${String(today.getDate()).padStart(2, '0')}æ—¥`;
        }
        return dateStr;
    }
    
    function sanitizeFilename(filename) {
        return filename.replace(/[^a-z0-9\u4e00-\u9fa5_\-\.\(\)\[\]]/gi, '_').replace(/_+/g, '_');
    }

    const previousReportUrl = "åœ¨æ­¤å¤„å¡«å†™ä¸Šå‘¨å‘¨æŠ¥çš„URL"; 

    function showReportFeedbackMessage(message, type = 'info', duration = 3000) { 
        const feedbackElement = document.getElementById('feedback-message'); 
        if (feedbackElement) {
            feedbackElement.textContent = message;
            feedbackElement.className = type; 
            setTimeout(() => {
                feedbackElement.textContent = '';
                feedbackElement.className = '';
            }, duration);
        }
    }
    
    async function captureScreenshot(elementToCapture) {
        await document.fonts.ready; 
        return html2canvas(elementToCapture, { 
            useCORS: true, 
            scale: window.devicePixelRatio || 1, 
            logging: false, 
            backgroundColor: getCssVariable('--bg-primary', '#f5f4ee'), 
            scrollX: -window.scrollX, 
            scrollY: -window.scrollY,
            windowWidth: document.documentElement.scrollWidth,
            windowHeight: document.documentElement.scrollHeight,
            onclone: function(clonedDoc) {
                const highlightElements = clonedDoc.querySelectorAll('.highlight-keyword');
                highlightElements.forEach(el => {
                    el.style.display = 'inline';
                    el.style.padding = '1px 2px';
                    el.style.lineHeight = '1.2';
                    el.style.boxDecorationBreak = 'clone';
                    el.style.webkitBoxDecorationBreak = 'clone';
                });
            }
        });
    }

    const screenshotToClipboardBtn = document.getElementById('screenshotToClipboardBtn');
    if(screenshotToClipboardBtn) screenshotToClipboardBtn.addEventListener('click', async function() {
        const reportContent = document.getElementById('report-content-wrapper');
        if (!reportContent) {
            showReportFeedbackMessage('æˆªå›¾é”™è¯¯: æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚', 'error');
            return;
        }
        const actionButtons = document.querySelector('.action-buttons-container');
        const feedbackMsgElement = document.getElementById('feedback-message');
        const originalButtonText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¤„ç†ä¸­...';
        this.disabled = true;
        if(actionButtons) actionButtons.style.visibility = 'hidden'; 
        if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';

        try {
            const canvas = await captureScreenshot(reportContent);
            canvas.toBlob(async function(blob) {
                if (blob) {
                    try {
                        if (navigator.clipboard && navigator.clipboard.write) {
                            await navigator.clipboard.write([
                                new ClipboardItem({ 'image/png': blob })
                            ]);
                            showReportFeedbackMessage('æˆªå›¾å·²æ‹·è´åˆ°å‰ªè´´æ¿!', 'success');
                        } else {
                            const dataUrl = canvas.toDataURL('image/png');
                            const img = document.createElement('img');
                            img.src = dataUrl;
                            const div = document.createElement('div');
                            div.contentEditable = true;
                            div.appendChild(img);
                            document.body.appendChild(div);
                            div.focus();
                            document.execCommand('SelectAll');
                            document.execCommand('Copy'); 
                            document.body.removeChild(div);
                            showReportFeedbackMessage('æˆªå›¾å·²å°è¯•æ‹·è´ (æ—§æ–¹æ³•)ã€‚è¯·æ£€æŸ¥å‰ªè´´æ¿æˆ–å°è¯•ä¸‹è½½ã€‚', 'info', 5000);
                        }
                    } catch (copyError) {
                        console.error('æ‹·è´åˆ°å‰ªè´´æ¿å¤±è´¥:', copyError);
                        showReportFeedbackMessage('æ‹·è´æˆªå›¾åˆ°å‰ªè´´æ¿å¤±è´¥: ' + copyError.message, 'error', 5000);
                    }
                } else {
                    throw new Error('æ— æ³•å°†Canvasè½¬æ¢ä¸ºBlobã€‚');
                }
            }, 'image/png');
        } catch (error) {
            console.error('æˆªå›¾æ•è·å¤±è´¥:', error);
            showReportFeedbackMessage('æˆªå›¾æ•è·å¤±è´¥: ' + error.message, 'error');
        } finally {
            if(actionButtons) actionButtons.style.visibility = 'visible'; 
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible'; 
            this.innerHTML = originalButtonText;
            this.disabled = false;
        }
    });

    const screenshotDownloadBtn = document.getElementById('screenshotDownloadBtn');
    if(screenshotDownloadBtn) screenshotDownloadBtn.addEventListener('click', async function() {
        const reportContent = document.getElementById('report-content-wrapper');
        if (!reportContent) {
            showReportFeedbackMessage('æˆªå›¾é”™è¯¯: æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚', 'error');
            return;
        }
        const actionButtons = document.querySelector('.action-buttons-container');
        const feedbackMsgElement = document.getElementById('feedback-message');
        const originalButtonText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ç”Ÿæˆä¸­...';
        this.disabled = true;
        if(actionButtons) actionButtons.style.visibility = 'hidden';
        if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';

        try {
            const canvas = await captureScreenshot(reportContent);
            const image = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            
            const webpageName = getWebpageNameForFilename();
            const dateString = getDateStringForFilename();
            let filename = sanitizeFilename(webpageName + '-' + dateString) + '.png';

            link.href = image;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showReportFeedbackMessage('æˆªå›¾å·²ä¸‹è½½!', 'success');
        } catch (error) {
            console.error('ä¸‹è½½æˆªå›¾å¤±è´¥:', error);
            showReportFeedbackMessage('ä¸‹è½½æˆªå›¾å¤±è´¥: ' + error.message, 'error');
        } finally {
            if(actionButtons) actionButtons.style.visibility = 'visible';
            if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';
            this.innerHTML = originalButtonText;
            this.disabled = false;
        }
    });
    
    const downloadHtmlBtn = document.getElementById('downloadHtmlBtn');
    if(downloadHtmlBtn) downloadHtmlBtn.addEventListener('click', function() {
        try {
            // Create a clone of the document to modify for download
            const clonedDocument = document.documentElement.cloneNode(true);
            
            // Remove the initial embedded SVG from the clone if it exists, 
            // so the downloaded HTML relies on JS to render the Mermaid diagram.
            const mindmapContainerClone = clonedDocument.querySelector('#mainMermaidContainer');
            if (mindmapContainerClone) {
                 // Replace with a placeholder or the JS-driven definition
                mindmapContainerClone.innerHTML = ``;
            }

            const htmlContent = clonedDocument.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            
            const webpageName = getWebpageNameForFilename();
            const dateString = getDateStringForFilename();
            let filename = sanitizeFilename(webpageName + '-' + dateString) + '.html';
            
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href); 
            showReportFeedbackMessage('HTMLæŠ¥å‘Šå·²ä¸‹è½½!', 'success');
        } catch (error) {
            console.error('ä¸‹è½½HTMLå¤±è´¥:', error);
            showReportFeedbackMessage('ä¸‹è½½HTMLå¤±è´¥: ' + error.message, 'error');
        }
    });

    const copyHtmlBtn = document.getElementById('copyHtmlBtn');
    if(copyHtmlBtn) copyHtmlBtn.addEventListener('click', function() {
        // Similar to download, provide a clean version for copy if needed
        const clonedDocument = document.documentElement.cloneNode(true);
        const mindmapContainerClone = clonedDocument.querySelector('#mainMermaidContainer');
        if (mindmapContainerClone) {
            mindmapContainerClone.innerHTML = ``;
        }
        const htmlContent = clonedDocument.outerHTML;

        const Gthis = this; 
        const originalButtonHTML = Gthis.innerHTML; 
        const textarea = document.createElement('textarea');
        textarea.value = htmlContent;
        textarea.style.position = 'fixed'; 
        textarea.style.top = '-9999px'; 
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        try {
            textarea.select();
            textarea.setSelectionRange(0, textarea.value.length); 
            if (document.execCommand('copy')) {
                Gthis.innerHTML = '<i class="fas fa-check"></i> å·²æ‹·è´!';
                showReportFeedbackMessage('HTMLå·²æ‹·è´åˆ°å‰ªè´´æ¿!', 'success', 2000);
            } else {
                Gthis.innerHTML = '<i class="fas fa-times"></i> æ‹·è´å¤±è´¥';
                showReportFeedbackMessage('æ‹·è´å¤±è´¥ã€‚æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒæ­¤æ“ä½œã€‚', 'error', 2000);
            }
        } catch (err) {
            Gthis.innerHTML = '<i class="fas fa-times"></i> æ‹·è´å‡ºé”™';
            showReportFeedbackMessage('æ‹·è´å‡ºé”™: ' + err.message, 'error', 2000);
            console.error('æ‹·è´HTMLæºç å‡ºé”™:', err);
        } finally {
            setTimeout(function() { 
                Gthis.innerHTML = originalButtonHTML; 
            }, 2000);
            document.body.removeChild(textarea);
        }
    });

    const viewPreviousReportBtn = document.getElementById('viewPreviousReportBtn');
    if(viewPreviousReportBtn) viewPreviousReportBtn.addEventListener('click', function() {
        const urlToOpen = previousReportUrl.trim();
        const placeholderUrlText = "åœ¨æ­¤å¤„å¡«å†™ä¸Šå‘¨å‘¨æŠ¥çš„URL"; 
        if (urlToOpen && urlToOpen !== placeholderUrlText && (urlToOpen.startsWith('http://') || urlToOpen.startsWith('https://') || !urlToOpen.includes('://'))) {
            let finalUrl = urlToOpen;
            const newWindow = window.open(finalUrl, '_blank'); 
            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                showReportFeedbackMessage('æ— æ³•æ‰“å¼€æ–°çª—å£ã€‚è¯·æ£€æŸ¥æ‚¨çš„å¼¹å‡ºçª—å£æ‹¦æˆªè®¾ç½®ã€‚', 'error', 5000);
            }
        } else {
            showReportFeedbackMessage('ä¸Šå‘¨å‘¨æŠ¥çš„URLæœªé…ç½®æˆ–æ— æ•ˆã€‚è¯·æ£€æŸ¥è„šæœ¬ä¸­çš„ previousReportUrl å˜é‡ã€‚', 'error', 5000);
        }
    });

    function adjustActionButtonsLayout() {
        const actionButtonsContainer = document.querySelector('.action-buttons-container');
        if (actionButtonsContainer) {
            if (window.innerWidth <= 768) { 
                actionButtonsContainer.style.display = 'flex';
                actionButtonsContainer.style.flexWrap = 'wrap';
                actionButtonsContainer.style.justifyContent = 'center';
            } else { 
                actionButtonsContainer.style.display = 'block'; 
                actionButtonsContainer.style.flexWrap = 'nowrap'; 
            }
        }
    }
    
    window.addEventListener('load', () => {
        initializeMainDiagram(); 
        adjustActionButtonsLayout(); 
    });
    window.addEventListener('resize', adjustActionButtonsLayout); 

    // --- Report Page JavaScript END ---
</script>
</body>
</html>